{"version":3,"file":"static/js/3809.a9295799.chunk.js","mappings":"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","sources":["../node_modules/@adobecom/standalone-feds/dist|lazy|/^.*//features//spectrum/-web/-components//dist//progress/-circle/.js$/|groupOptions: {}|strict namespace object","../node_modules/@adobecom/standalone-feds/dist|lazy|/^.*//features//spectrum/-web/-components//dist//theme/.js$/|groupOptions: {}|strict namespace object","../node_modules/@adobecom/blocks/merch/upgrade.js"],"sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(() => {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = () => ([]);\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 3664;\nmodule.exports = webpackEmptyAsyncContext;","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(() => {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = () => ([]);\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 4417;\nmodule.exports = webpackEmptyAsyncContext;","import { createTag, getConfig, reloadPage } from '../../utils/utils.js';\nimport { replaceKey } from '../../features/placeholders.js';\n\nconst MANAGE_PLAN_MSG_SUBTYPE = {\n  AppLoaded: 'AppLoaded',\n  EXTERNAL: 'EXTERNAL',\n  SWITCH: 'SWITCH',\n  RETURN_BACK: 'RETURN_BACK',\n  OrderComplete: 'OrderComplete',\n  Error: 'Error',\n  Close: 'Close',\n};\nconst isProductFamily = (offer, pfs) => {\n  const productFamily = offer?.offer?.product_arrangement?.family;\n  return productFamily && pfs.includes(productFamily);\n};\nexport const LANA_OPTIONS = {\n  clientId: 'merch-at-scale',\n  sampleRate: 10,\n  tags: 'manage-plan',\n};\n\nexport const lanaLog = async (msg, subType) => {\n  const { userId } = await window.adobeIMS?.getProfile() ?? {};\n  window.lana?.log(`ManagePlan/${subType}/${userId}: ${msg}`, LANA_OPTIONS);\n};\n\nlet shouldRefetchEntitlements = false;\n\nfunction buildUrl(upgradeOffer, upgradable, env) {\n  const toOffer = upgradeOffer?.value[0].offerId;\n  const fromOffer = upgradable?.offer?.offer_id;\n  if (!toOffer || !fromOffer) return undefined;\n  const url = new URL(env?.name === 'prod' ? 'https://plan.adobe.com' : 'https://stage.plan.adobe.com');\n  url.searchParams.append('intent', 'switch');\n  url.searchParams.append('toOfferId', toOffer);\n  url.searchParams.append('fromOffer', fromOffer);\n  url.searchParams.append('language', 'en'); // todo check where comes from\n  url.searchParams.append('surface', 'ADOBE_COM');\n  url.searchParams.append('ctx', 'if');\n  url.searchParams.append('ctxRtUrl', encodeURIComponent(window.location.href));\n  if (upgradeOffer.dataset?.promotionCode) {\n    url.searchParams.append('promoCode', upgradeOffer.dataset.promotionCode);\n  }\n  return url.toString();\n}\n\nexport const handleIFrameEvents = ({ data: msgData }) => {\n  let parsedMsg = null;\n  try {\n    parsedMsg = JSON.parse(msgData);\n  } catch (error) {\n    return;\n  }\n  const { app, subType, data } = parsedMsg || {};\n\n  if (app !== 'ManagePlan') return;\n  switch (subType) {\n    case MANAGE_PLAN_MSG_SUBTYPE.AppLoaded:\n      document.querySelector('.upgrade-flow-content iframe')?.classList?.remove('loading');\n      document.querySelector('.upgrade-flow-content sp-theme')?.remove();\n      lanaLog('Showing modal', subType);\n      break;\n    case MANAGE_PLAN_MSG_SUBTYPE.EXTERNAL:\n      if (!data?.externalUrl || !data.target) return;\n      lanaLog('Opening external URL', subType);\n      window.open(data.externalUrl, data.target);\n      break;\n    case MANAGE_PLAN_MSG_SUBTYPE.SWITCH:\n      if (!data?.externalUrl || !data.target) return;\n      lanaLog('Opening external URL (SWITCH)', subType);\n      window.open(data.externalUrl, data.target);\n      break;\n    case MANAGE_PLAN_MSG_SUBTYPE.RETURN_BACK:\n      if (!data?.externalUrl || !data.target) return;\n      if (data.returnUrl) {\n        window.sessionStorage.setItem('upgradeModalReturnUrl', data.returnUrl);\n      }\n      lanaLog('Opening external URL (RETURN_BACK)', subType);\n      window.open(data.externalUrl, data.target);\n      break;\n    case MANAGE_PLAN_MSG_SUBTYPE.OrderComplete:\n      shouldRefetchEntitlements = true;\n      break;\n    case MANAGE_PLAN_MSG_SUBTYPE.Error:\n      break;\n    case MANAGE_PLAN_MSG_SUBTYPE.Close:\n      if (shouldRefetchEntitlements) {\n        lanaLog('Reloading page to update entitlements', subType);\n        reloadPage();\n      }\n      lanaLog('Closing modal', subType);\n      document.querySelector('.dialog-modal.upgrade-flow-modal')?.dispatchEvent(new Event('closeModal'));\n      break;\n    default:\n      break;\n  }\n};\n\nexport default async function handleUpgradeOffer(\n  ctaPF,\n  upgradeOffer,\n  entitlements,\n  SOURCE_PF,\n  TARGET_PF,\n) {\n  if (!TARGET_PF.includes(ctaPF)) return undefined;\n\n  const hasUpgradeTarget = entitlements?.find((offer) => isProductFamily(offer, TARGET_PF));\n  if (hasUpgradeTarget) return undefined;\n\n  const changePlanOffers = entitlements?.filter((offer) => offer.change_plan_available === true);\n  const upgradable = changePlanOffers?.find((offer) => isProductFamily(offer, SOURCE_PF));\n  if (!upgradable) return undefined;\n\n  const { env, base } = getConfig();\n  const upgradeUrl = buildUrl(upgradeOffer, upgradable, env);\n  if (upgradeUrl) {\n    window.addEventListener('message', handleIFrameEvents);\n    const { getModal } = await import('../modal/modal.js');\n    const showModal = async (e, hash) => {\n      e.preventDefault();\n      await Promise.all([\n        import(`${base}/features/spectrum-web-components/dist/theme.js`),\n        import(`${base}/features/spectrum-web-components/dist/progress-circle.js`),\n      ]);\n      const content = createTag('div', { class: 'upgrade-flow-content' });\n      const iframe = createTag('iframe', {\n        src: upgradeUrl,\n        title: 'Upgrade modal',\n        frameborder: '0',\n        marginwidth: '0',\n        marginheight: '0',\n        allowfullscreen: 'true',\n        loading: 'lazy',\n        class: 'loading upgrade-flow-iframe',\n      });\n      const pCircle = createTag('sp-progress-circle', { label: 'progress circle', indeterminate: true, size: 'l' });\n      const theme = createTag('sp-theme', { theme: 'spectrum', color: 'light', scale: 'medium', dir: 'ltr' });\n      theme.append(pCircle);\n      content.append(theme);\n      content.append(iframe);\n      if (hash) {\n        const prevHash = window.location.hash.replace('#', '') === hash ? '' : window.location.hash;\n        window.location.hash = hash;\n        window.addEventListener('milo:modal:closed', () => {\n          window.location.hash = prevHash;\n        }, { once: true });\n      }\n      return getModal(null, { id: 'switch-modal', content, closeEvent: 'closeModal', class: ['upgrade-flow-modal'] });\n    };\n    const text = await replaceKey('upgrade-now', getConfig());\n    return { text, className: 'upgrade', url: upgradeUrl, handler: showModal };\n  }\n  return undefined;\n}\n"],"names":["webpackEmptyAsyncContext","req","Promise","resolve","then","e","Error","code","keys","id","module","exports","MANAGE_PLAN_MSG_SUBTYPE","isProductFamily","offer","pfs","_offer$offer","productFamily","product_arrangement","family","includes","LANA_OPTIONS","clientId","sampleRate","tags","lanaLog","async","msg","subType","_await$window$adobeIM","_window$adobeIMS","_window$lana","userId","window","adobeIMS","getProfile","lana","log","concat","shouldRefetchEntitlements","handleIFrameEvents","_ref","_document$querySelect","_document$querySelect2","_document$querySelect3","data","msgData","parsedMsg","JSON","parse","error","app","document","querySelector","classList","remove","externalUrl","target","open","returnUrl","sessionStorage","setItem","reloadPage","dispatchEvent","Event","handleUpgradeOffer","ctaPF","upgradeOffer","entitlements","SOURCE_PF","TARGET_PF","find","changePlanOffers","filter","change_plan_available","upgradable","env","base","getConfig","upgradeUrl","_upgradable$offer","_upgradeOffer$dataset","toOffer","value","offerId","fromOffer","offer_id","url","URL","name","searchParams","append","encodeURIComponent","location","href","dataset","promotionCode","toString","buildUrl","addEventListener","getModal","showModal","hash","preventDefault","all","content","createTag","class","iframe","src","title","frameborder","marginwidth","marginheight","allowfullscreen","loading","pCircle","label","indeterminate","size","theme","color","scale","dir","prevHash","replace","once","closeEvent","text","replaceKey","className","handler"],"sourceRoot":""}