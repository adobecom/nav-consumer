"use strict";(self.webpackChunknav_consumer=self.webpackChunknav_consumer||[]).push([[769,42,832,9818],{42:(n,e,t)=>{function o(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;if("function"!==typeof n)return;let t=null;return function(){for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];clearTimeout(t),t=setTimeout((()=>n(...i)),e)}}t.r(e),t.d(e,{debounce:()=>o})},832:(n,e,t)=>{t.r(e),t.d(e,{stylePublish:()=>c});var o=t(9818),i=async function(n){var e,t;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!n)return!1;const{live:r,profile:s,webPath:a}=n;let l=!i||(null===r||void 0===r||null===(e=r.permissions)||void 0===e?void 0:e.includes("write")),d="Publishing is currently disabled for this page";const c=await(0,o.getCustomConfig)("/.milo/publish-permissions-config.json?limit=50000"),u=null===c||void 0===c||null===(t=c.urls)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.find((n=>{let{url:e}=n;return e.endsWith("**")?a.includes(e.slice(0,-2)):e===a}));if(u){l=!1,u.message&&(d=u.message);const n=c[u.group];if(n&&null!==s&&void 0!==s&&s.email){var p;let e;const t=null===(p=n.data)||void 0===p?void 0:p.find((n=>{let{allow:t,deny:o}=n;return o?(e=!0,o===s.email):t===s.email}));l=e?!t:!!t}}return{canPublish:l,message:d}},r=".publish.plugin button",s=".profile-email",a="Are you sure? This will publish to production.",l=!1;async function d(n,e){const{canPublish:t,message:o}=await i(n,!1);t?e.removeAttribute("disabled"):(e.setAttribute("disabled",!0),e.insertAdjacentHTML("beforeend","<span>".concat(o,"</span>")),setTimeout((()=>e.querySelector("span").remove()),4e3))}async function c(n){var e,t;if(l)return;if(l=!0,"HELIX-SIDEKICK"===n.nodeName)return void function(n){const e=async(n,e)=>{const{canPublish:t,message:o}=await i(n,!1);t?e.removeAttribute("disabled"):e.setAttribute("disabled",!0);const r=e.querySelector("span"),s=t?a:o;r?r.innerText=s:e.insertAdjacentHTML("beforeend","<span>".concat(s,"</span>"))},t=new CSSStyleSheet;t.replaceSync("\n    :host {\n      --bg-color: rgb(129 27 14);\n      --text-color: #fff0f0;\n      color-scheme: light dark;\n    }\n    .publish.plugin {\n      order: 100;\n    }\n    .publish.plugin button {\n      position: relative;\n    }\n    .publish.plugin button:not([disabled=true]) {\n      background: var(--bg-color);\n      border-color: #b46157;\n      color: var(--text-color);\n    }\n    .publish.plugin button:not([disabled=true]):hover {\n      background-color: var(--hlx-sk-button-hover-bg);\n      border-color: unset;\n      color: var(--hlx-sk-button-hover-color);\n    }\n    .publish.plugin button > span {\n      display: none;\n      background: #666;\n      border-radius: 4px;\n      line-height: 1.2rem;\n      padding: 8px 12px;\n      position: absolute;\n      top: 34px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 150px;\n      white-space: pre-wrap;\n    }\n    .publish.plugin button:not([disabled=true]) > span {\n      background: var(--bg-color);\n    }\n    .publish.plugin button:hover > span {\n      display: block;\n      color: var(--text-color);\n    }\n    .publish.plugin button > span:before {\n      content: '';\n      border-left: 6px solid transparent;\n      border-right: 6px solid transparent;\n      border-bottom: 6px solid #666;\n      position: absolute;\n      text-align: center;\n      top: -6px;\n      left: 50%;\n      transform: translateX(-50%);\n    }\n    .publish.plugin button:not([disabled=true]) > span:before {\n      border-bottom: 6px solid var(--bg-color);\n    }\n  "),n.shadowRoot.adoptedStyleSheets=[t],n.addEventListener("statusfetched",(async n=>{var t,o;const i=null===n||void 0===n||null===(t=n.detail)||void 0===t?void 0:t.data,s=null===n||void 0===n||null===(o=n.target)||void 0===o||null===(o=o.shadowRoot)||void 0===o?void 0:o.querySelector(r);i&&s&&e(i,s)})),setTimeout((async()=>{const t=n.shadowRoot.querySelector(r);null===t||void 0===t||t.setAttribute("disabled",!0);const o=null===t||void 0===t?void 0:t.querySelector("span");if(t&&!o){var i;const o={webPath:window.location.pathname,profile:{email:null===(i=n.shadowRoot.querySelector(s))||void 0===i?void 0:i.innerText}};e(o,t)}}),500)}(n);const o=new CSSStyleSheet;o.replaceSync("\n    sk-action-button.publish {\n      position: relative;\n    }\n    sk-action-button.publish > span {\n      display: none;\n      background: #777;\n      border-radius: 4px;\n      line-height: 1.2rem;\n      padding: 8px 12px;\n      position: absolute;\n      bottom: 34px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 150px;\n      white-space: pre-wrap;\n      color: black;\n    }\n    sk-action-button.publish[disabled] > span {\n      display: block;\n    }\n    sk-action-button.publish > span:before {\n      content: '';\n      border-left: 6px solid transparent;\n      border-right: 6px solid transparent;\n      border-top: 6px solid #777;\n      position: absolute;\n      text-align: center;\n      bottom: -6px;\n      left: 50%;\n      transform: translateX(-50%);\n    }\n  ");const c=n.shadowRoot.querySelector("plugin-action-bar").shadowRoot;null!==(e=c.adoptedStyleSheets)&&void 0!==e||(c.adoptedStyleSheets=[]),c.adoptedStyleSheets.push(o);const u=c.querySelector("sk-action-button.publish");u||n.addEventListener("status-fetched",(n=>{let{target:e,detail:t}=n;setTimeout((async()=>{const n=e.shadowRoot.querySelector("plugin-action-bar").shadowRoot.querySelector("sk-action-button.publish");t&&n&&await d(t,n)}),0)}));const p={webPath:window.location.pathname,profile:{email:null===(t=c.querySelector("#user"))||void 0===t||null===(t=t.shadowRoot.querySelector('.user [slot="description"]'))||void 0===t?void 0:t.innerText}};p&&u&&await d(p,u)}},9818:(n,e,t)=>{t.r(e),t.d(e,{getCustomConfig:()=>r,getImsToken:()=>i});var o={},i=async n=>{var e;return window.adobeid={client_id:"milo_ims",environment:"prod",scope:"AdobeID,openid"},window.adobeIMS||await n("https://auth.services.adobe.com/imslib/imslib.min.js"),null===(e=window.adobeIMS)||void 0===e||null===(e=e.getAccessToken())||void 0===e?void 0:e.token},r=async n=>{if(void 0!==o[n])return o[n];let e=null;const t=await fetch(n);return t.ok&&(e=await t.json()),o[n]=e,o[n]}},769:(n,e,t)=>{t.r(e),t.d(e,{default:()=>r});var o=t(832),i=(t(9818),t(42));t(6850);function r(n){let{createTag:e,loadBlock:r,loadScript:s,loadStyle:a}=n;document.addEventListener("send-to-caas",(async n=>{const{host:e,project:o,branch:i,repo:r,owner:l}=n.detail,{sendToCaaS:d}=await t.e(1127).then(t.bind(t,1127));d({host:e,project:o,branch:i,repo:r,owner:l},s,a)}));const l=document.querySelector("aem-sidekick, helix-sidekick");l.addEventListener("custom:send-to-caas",(async n=>{const{host:e,project:o,ref:i,repo:r,owner:l}=n.detail.data.config,{sendToCaaS:d}=await Promise.resolve().then(t.bind(t,1009));d({host:e,project:o,branch:i,repo:r,owner:l},s,a)})),l.addEventListener("custom:check-schema",(async()=>{if(null===document.querySelector('script[type="application/ld+json"]'))return;window.open("".concat("https://search.google.com/test/rich-results?url=").concat(encodeURIComponent(window.location.href)),"check-schema")})),l.addEventListener("custom:preflight",(0,i.debounce)((()=>(async()=>{const n=e("div",{class:"preflight"}),o=await r(n),{getModal:i}=await t.e(9139).then(t.bind(t,1520));i(null,{id:"preflight",content:o,closeEvent:"closeModal"})})()),500)),(0,o.stylePublish)(l)}}}]);
//# sourceMappingURL=769.dd3f40a9.chunk.js.map