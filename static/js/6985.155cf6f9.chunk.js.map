{"version":3,"file":"static/js/6985.155cf6f9.chunk.js","mappings":"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","sources":["../../milo/libs/martech/martech.js"],"sourcesContent":["import {\n  getConfig, loadIms, loadLink, loadScript, getMepEnablement, getMetadata,\n} from '../utils/utils.js';\n\nconst ALLOY_PROPOSITION_FETCH = 'alloy_propositionFetch';\nconst ALLOY_SEND_EVENT = 'alloy_sendEvent';\nconst ALLOY_SEND_EVENT_ERROR = 'alloy_sendEvent_error';\nconst ENTITLEMENT_TIMEOUT = 3000;\n\nconst TARGET_TIMEOUT_MS = 4000;\nconst params = new URL(window.location.href).searchParams;\nconst timeout = parseInt(params.get('target-timeout'), 10)\n  || parseInt(getMetadata('target-timeout'), 10)\n  || TARGET_TIMEOUT_MS;\n\nconst setDeep = (obj, path, value) => {\n  const pathArr = path.split('.');\n  let currentObj = obj;\n\n  for (const key of pathArr.slice(0, -1)) {\n    if (!currentObj[key] || typeof currentObj[key] !== 'object') {\n      currentObj[key] = {};\n    }\n    currentObj = currentObj[key];\n  }\n\n  currentObj[pathArr[pathArr.length - 1]] = value;\n};\n\n// eslint-disable-next-line max-len\nconst waitForEventOrTimeout = (eventName, timeoutLocal, returnValIfTimeout) => new Promise((resolve) => {\n  const listener = (event) => {\n    // eslint-disable-next-line no-use-before-define\n    clearTimeout(timer);\n    resolve(event.detail);\n  };\n\n  const errorListener = () => {\n    // eslint-disable-next-line no-use-before-define\n    clearTimeout(timer);\n    resolve({ error: true });\n  };\n\n  const timer = setTimeout(() => {\n    window.removeEventListener(eventName, listener);\n    if (returnValIfTimeout !== undefined) {\n      resolve(returnValIfTimeout);\n    } else {\n      resolve({ timeout: true });\n    }\n  }, timeoutLocal);\n\n  const eventError = eventName\n    === ALLOY_SEND_EVENT ? ALLOY_SEND_EVENT_ERROR : ALLOY_PROPOSITION_FETCH;\n  window.addEventListener(eventName, listener, { once: true });\n  window.addEventListener(eventError, errorListener, { once: true });\n});\n\nfunction roundToQuarter(num) {\n  return Math.ceil(num / 250) / 4;\n}\n\nfunction calculateResponseTime(responseStart) {\n  const responseTime = Date.now() - responseStart;\n  return roundToQuarter(responseTime);\n}\n\nexport const getTargetAjoPersonalization = async (\n  { handleAlloyResponse, config, sendTargetResponseAnalytics },\n) => {\n  const responseStart = Date.now();\n  const ajo = config.mep.ajoEnabled;\n  const eventName = ajo ? ALLOY_PROPOSITION_FETCH : ALLOY_SEND_EVENT;\n  const targetAjo = ajo ? 'ajo' : 'target';\n  window.addEventListener(eventName, () => {\n    const responseTime = calculateResponseTime(responseStart);\n    try {\n      window.lana.log(`target response time: ${responseTime}`, {\n        tags: 'martech',\n        errorType: 'e',\n        sampleRate: 0.5,\n      });\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.error('Error logging target response time:', e);\n    }\n  }, { once: true });\n\n  let targetAjoManifests = [];\n  let targetAjoPropositions = [];\n\n  const response = await waitForEventOrTimeout(eventName, timeout);\n\n  if (response.error) {\n    try {\n      window.lana.log(`${targetAjo} response time: ad blocker`, {\n        tags: 'martech',\n        errorType: 'e',\n        sampleRate: 0.5,\n      });\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.error(`Error logging ${targetAjo} response time for ad blocker:`, e);\n    }\n    return { targetAjoManifests, targetAjoPropositions };\n  }\n  if (response.timeout) {\n    waitForEventOrTimeout(eventName, 5100 - timeout)\n      .then(() => sendTargetResponseAnalytics(true, responseStart, timeout));\n  } else {\n    sendTargetResponseAnalytics(false, responseStart, timeout);\n    targetAjoManifests = handleAlloyResponse(response.result);\n    targetAjoPropositions = response.result?.propositions || [];\n  }\n\n  return { targetAjoManifests, targetAjoPropositions };\n};\n\nconst setupEntitlementCallback = () => {\n  const setEntitlements = async (destinations) => {\n    const { getEntitlements } = await import('../features/personalization/personalization.js');\n    return getEntitlements(destinations);\n  };\n\n  const getEntitlements = (resolve) => {\n    const handleEntitlements = (detail) => {\n      if (detail?.result?.destinations?.length) {\n        resolve(setEntitlements(detail.result.destinations));\n      } else {\n        resolve([]);\n      }\n    };\n    waitForEventOrTimeout(ALLOY_SEND_EVENT, ENTITLEMENT_TIMEOUT, [])\n      .then(handleEntitlements)\n      .catch(() => resolve([]));\n  };\n\n  const { miloLibs, codeRoot, entitlements: resolveEnt } = getConfig();\n  getEntitlements(resolveEnt);\n\n  loadLink(\n    `${miloLibs || codeRoot}/features/personalization/personalization.js`,\n    { as: 'script', rel: 'modulepreload' },\n  );\n};\n\nfunction isProxied() {\n  return /^(www|milo|business|blog|news)(\\.stage)?\\.adobe\\.com$/.test(window.location.hostname);\n}\n\nlet filesLoadedPromise = false;\nconst loadMartechFiles = async (config) => {\n  if (filesLoadedPromise) return filesLoadedPromise;\n\n  filesLoadedPromise = async () => {\n    if (getMepEnablement('xlg') === 'loggedout') {\n      setupEntitlementCallback();\n    } else {\n      loadIms()\n        .then(() => {\n          if (window.adobeIMS.isSignedInUser()) setupEntitlementCallback();\n        })\n        .catch(() => { });\n    }\n\n    setDeep(\n      window,\n      'alloy_all.data._adobe_corpnew.digitalData.page.pageInfo.language',\n      { locale: config.locale.prefix.replace('/', ''), langCode: config.locale.ietf },\n    );\n    setDeep(window, 'digitalData.diagnostic.franklin.implementation', 'milo');\n\n    const launchUrl = config.env.consumer?.marTechUrl || (\n      isProxied()\n        ? '/marketingtech'\n        : 'https://assets.adobedtm.com'\n    ) + (\n      config.env.name === 'prod'\n        ? '/d4d114c60e50/a0e989131fd5/launch-5dd5dd2177e6.min.js'\n        : '/d4d114c60e50/a0e989131fd5/launch-2c94beadc94f-development.min.js'\n    );\n    loadLink(launchUrl, { as: 'script', rel: 'preload' });\n\n    window.marketingtech = {\n      adobe: {\n        launch: {\n          url: launchUrl,\n          controlPageLoad: true,\n        },\n        alloy: {\n          edgeConfigId: config.env.consumer?.edgeConfigId || config.env.edgeConfigId,\n          edgeDomain: (\n            isProxied()\n              ? window.location.hostname\n              : 'sstats.adobe.com'\n          ),\n          edgeBasePath: (\n            isProxied()\n              ? 'experienceedge'\n              : 'ee'\n          ),\n        },\n        target: false,\n      },\n      milo: true,\n    };\n    window.edgeConfigId = config.env.edgeConfigId;\n\n    await loadScript((\n      isProxied()\n        ? ''\n        : 'https://www.adobe.com'\n    ) + (\n      config.env.name === 'prod'\n        ? '/marketingtech/main.standard.min.js'\n        : '/marketingtech/main.standard.qa.min.js'\n    ));\n    // eslint-disable-next-line no-underscore-dangle\n    window._satellite.track('pageload');\n  };\n\n  await filesLoadedPromise();\n  return filesLoadedPromise;\n};\n\nexport default async function init() {\n  const config = getConfig();\n  const martechPromise = loadMartechFiles(config);\n  return martechPromise;\n}\n"],"names":["I","f","O","URL","window","location","href","searchParams","m","parseInt","get","E","L","setDeep","e","a","r","n","split","o","t","slice","length","h","waitForEventOrTimeout","Promise","l","clearTimeout","s","detail","setTimeout","removeEventListener","timeout","i","addEventListener","once","errorListener","error","C","Math","ceil","M","Date","now","S","async","_d$result","handleAlloyResponse","config","sendTargetResponseAnalytics","_ref","mep","ajoEnabled","p","lana","log","concat","tags","errorType","sampleRate","j","console","d","targetAjoManifests","targetAjoPropositions","then","result","propositions","y","setupEntitlementCallback","miloLibs","codeRoot","entitlements","u","_i$result","destinations","getEntitlements","catch","w","as","rel","g","test","hostname","c","R","_e$env$consumer","_e$env$consumer2","b","_","adobeIMS","isSignedInUser","locale","prefix","replace","langCode","ietf","env","consumer","marTechUrl","name","marketingtech","adobe","launch","url","controlPageLoad","alloy","edgeConfigId","edgeDomain","edgeBasePath","target","milo","T","_satellite","track","A"],"sourceRoot":""}