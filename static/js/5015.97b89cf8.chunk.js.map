{"version":3,"file":"static/js/5015.97b89cf8.chunk.js","mappings":"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","sources":["../node_modules/@adobecom/blocks/fragment/fragment.js"],"sourcesContent":["/* eslint-disable max-classes-per-file */\nimport { createTag, getConfig, loadArea, localizeLink, customFetch } from '../../utils/utils.js';\n\nconst fragMap = {};\n\nconst removeHash = (url) => {\n  const urlNoHash = url.split('#')[0];\n  return url.includes('#_dnt') ? `${urlNoHash}#_dnt` : urlNoHash;\n};\n\nconst isCircularRef = (href) => [...Object.values(fragMap)]\n  .some((tree) => {\n    const node = tree.find(href);\n    return node?.isRecursive;\n  });\n\nconst updateFragMap = (fragment, a, href) => {\n  const fragLinks = [...fragment.querySelectorAll('a')]\n    .filter((link) => localizeLink(link.href).includes('/fragments/'));\n  if (!fragLinks.length) return;\n\n  if (document.body.contains(a) && !a.parentElement?.closest('.fragment')) {\n    // eslint-disable-next-line no-use-before-define\n    fragMap[href] = new Tree(href);\n    fragLinks.forEach((link) => fragMap[href].insert(href, localizeLink(removeHash(link.href))));\n  } else {\n    Object.values(fragMap).forEach((tree) => {\n      const hrefNode = tree.find(href);\n      if (!hrefNode) return;\n\n      fragLinks.forEach((link) => {\n        const localizedHref = localizeLink(removeHash(link.href));\n        const parentNodeSameHref = hrefNode.findParent(localizedHref);\n        if (parentNodeSameHref) {\n          parentNodeSameHref.isRecursive = true;\n        } else {\n          hrefNode.addChild(localizedHref);\n        }\n      });\n    });\n  }\n};\n\nconst insertInlineFrag = async (sections, a, relHref) => {\n  // Inline fragments only support one section, other sections are ignored\n  const fragChildren = [...sections[0].children];\n  if (a.parentElement.nodeName === 'DIV' && !a.parentElement.attributes.length) {\n    a.parentElement.replaceWith(...fragChildren);\n  } else {\n    a.replaceWith(...fragChildren);\n  }\n  const promises = [];\n  fragChildren.forEach((child) => {\n    child.setAttribute('data-path', relHref);\n    if (child.querySelector('a[href*=\"/fragments/\"]')) promises.push(loadArea(child));\n  });\n  await Promise.all(promises);\n};\n\nfunction replaceDotMedia(path, doc) {\n  const resetAttributeBase = (tag, attr) => {\n    doc.querySelectorAll(`${tag}[${attr}^=\"./media_\"]`).forEach((el) => {\n      el[attr] = new URL(el.getAttribute(attr), new URL(path, window.location)).href;\n    });\n  };\n  resetAttributeBase('img', 'src');\n  resetAttributeBase('source', 'srcset');\n}\n\nexport default async function init(a) {\n  const { decorateArea, mep, placeholders, locale } = getConfig();\n  let relHref = localizeLink(a.href);\n  let inline = false;\n\n  if (a.parentElement?.nodeName === 'P') {\n    const children = a.parentElement.childNodes;\n    const div = createTag('div');\n    for (const attr of a.parentElement.attributes) div.setAttribute(attr.name, attr.value);\n    a.parentElement.replaceWith(div);\n    div.append(...children);\n  }\n\n  let mepFrag;\n  try {\n    const path = !a.href.includes('/federal/') ? new URL(a.href).pathname\n      : a.href.replace('#_inline', '');\n    mepFrag = mep?.fragments?.[path] || mep?.fragments?.[path.replace(locale.prefix, '')];\n  } catch (e) {\n    // do nothing\n  }\n  if (mepFrag) {\n    const { handleFragmentCommand } = await import('../../features/personalization/personalization.js');\n    relHref = handleFragmentCommand(mepFrag, a);\n    if (!relHref) return;\n  }\n\n  if (a.href.includes('#_inline')) {\n    inline = true;\n    a.href = a.href.replace('#_inline', '');\n    relHref = relHref.replace('#_inline', '');\n  }\n\n  if (isCircularRef(relHref)) {\n    window.lana?.log(`ERROR: Fragment Circular Reference loading ${a.href}`);\n    return;\n  }\n\n  let resourcePath = a.href;\n  if (a.href.includes('/federal/')) {\n    const { getFederatedUrl } = await import('../../utils/utils.js');\n    resourcePath = getFederatedUrl(a.href);\n  }\n  const resp = await customFetch({ resource: `${resourcePath}.plain.html`, withCacheRules: true })\n    .catch(() => ({}));\n\n  if (!resp?.ok) {\n    window.lana?.log(`Could not get fragment: ${resourcePath}.plain.html`);\n    return;\n  }\n\n  const html = await resp.text();\n  const doc = new DOMParser().parseFromString(html, 'text/html');\n  replaceDotMedia(a.href, doc);\n  if (decorateArea) decorateArea(doc, { fragmentLink: a });\n\n  const sections = doc.querySelectorAll('body > div');\n\n  if (!sections.length) {\n    window.lana?.log(`Could not make fragment: ${resourcePath}.plain.html`);\n    return;\n  }\n\n  const fragment = createTag('div', { class: 'fragment', 'data-path': relHref });\n  fragment.append(...sections);\n\n  updateFragMap(fragment, a, relHref);\n  if (a.dataset.manifestId\n    || a.dataset.adobeTargetTestid\n    || mep?.commands?.length\n    || placeholders) {\n    const { updateFragDataProps, handleCommands, replacePlaceholders } = await import('../../features/personalization/personalization.js');\n    if (a.dataset.manifestId || a.dataset.adobeTargetTestid) {\n      updateFragDataProps(a, inline, sections, fragment);\n    }\n    if (mep?.commands?.length) handleCommands(mep?.commands, fragment, false, true);\n    if (placeholders) fragment.innerHTML = replacePlaceholders(fragment.innerHTML, placeholders);\n  }\n  if (inline) {\n    await insertInlineFrag(sections, a, relHref, mep);\n  } else {\n    a.parentElement.replaceChild(fragment, a);\n    await loadArea(fragment);\n  }\n}\n\nclass Node {\n  constructor(key, value = key, parent = null) {\n    this.key = key;\n    this.value = value;\n    this.parent = parent;\n    this.children = [];\n    this.isRecursive = false;\n  }\n\n  addChild(key, value = key) {\n    const alreadyHasChild = this.children.some((n) => n.key === key);\n    if (!alreadyHasChild) {\n      this.children.push(new Node(key, value, this));\n    }\n  }\n\n  findParent(key) {\n    if (this.parent?.key === key) return this.parent;\n    return this.parent?.findParent(key);\n  }\n}\n\nexport class Tree {\n  constructor(key, value = key) {\n    this.root = new Node(key, value);\n  }\n\n  * traverse(node = this.root) {\n    yield node;\n    if (node.children.length) {\n      for (const child of node.children) {\n        yield* this.traverse(child);\n      }\n    }\n  }\n\n  insert(parentNodeKey, key, value = key) {\n    for (const node of this.traverse()) {\n      if (node.key === parentNodeKey) {\n        if (parentNodeKey === key) {\n          node.isRecursive = true;\n        } else {\n          node.children.push(new Node(key, value, node));\n        }\n        return true;\n      }\n    }\n    return false;\n  }\n\n  remove(key) {\n    for (const node of this.traverse()) {\n      const filtered = node.children.filter((c) => c.key !== key);\n      if (filtered.length !== node.children.length) {\n        node.children = filtered;\n        return true;\n      }\n    }\n    return false;\n  }\n\n  find(key) {\n    for (const node of this.traverse()) {\n      if (node.key === key) return node;\n    }\n    return undefined;\n  }\n}\n"],"names":["fragMap","removeHash","url","urlNoHash","split","includes","concat","isCircularRef","href","Object","values","some","tree","node","find","isRecursive","updateFragMap","fragment","a","_a$parentElement","fragLinks","querySelectorAll","filter","link","localizeLink","length","document","body","contains","parentElement","closest","forEach","hrefNode","localizedHref","parentNodeSameHref","findParent","addChild","Tree","insert","insertInlineFrag","async","sections","relHref","fragChildren","children","nodeName","attributes","replaceWith","promises","child","setAttribute","querySelector","push","loadArea","Promise","all","init","_a$parentElement2","_mep$commands","decorateArea","mep","placeholders","locale","getConfig","mepFrag","inline","childNodes","div","createTag","attr","name","value","append","_mep$fragments","_mep$fragments2","path","replace","URL","pathname","fragments","prefix","e","handleFragmentCommand","_window$lana","window","lana","log","resourcePath","getFederatedUrl","resp","customFetch","resource","withCacheRules","catch","_window$lana2","ok","html","text","doc","DOMParser","parseFromString","resetAttributeBase","tag","el","getAttribute","location","replaceDotMedia","fragmentLink","_window$lana3","class","dataset","manifestId","adobeTargetTestid","commands","_mep$commands2","updateFragDataProps","handleCommands","replacePlaceholders","innerHTML","replaceChild","Node","_Node","constructor","key","arguments","undefined","parent","this","n","_this$parent","_this$parent2","root","traverse","_this","parentNodeKey","remove","filtered","c"],"sourceRoot":""}