{"version":3,"file":"static/js/8480.23e3abc5.chunk.js","mappings":"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","sources":["../node_modules/@adobecom/martech/martech.js"],"sourcesContent":["import {\n  getConfig, loadIms, loadLink, loadScript, getMepEnablement, getMetadata,\n} from '../utils/utils.js';\n\nconst ALLOY_SEND_EVENT = 'alloy_sendEvent';\nconst ALLOY_SEND_EVENT_ERROR = 'alloy_sendEvent_error';\nconst ENTITLEMENT_TIMEOUT = 3000;\n\nconst TARGET_TIMEOUT_MS = 4000;\nconst params = new URL(window.location.href).searchParams;\nconst timeout = parseInt(params.get('target-timeout'), 10)\n  || parseInt(getMetadata('target-timeout'), 10)\n  || TARGET_TIMEOUT_MS;\n\nconst setDeep = (obj, path, value) => {\n  const pathArr = path.split('.');\n  let currentObj = obj;\n\n  for (const key of pathArr.slice(0, -1)) {\n    if (!currentObj[key] || typeof currentObj[key] !== 'object') {\n      currentObj[key] = {};\n    }\n    currentObj = currentObj[key];\n  }\n\n  currentObj[pathArr[pathArr.length - 1]] = value;\n};\n\n// eslint-disable-next-line max-len\nconst waitForEventOrTimeout = (eventName, timeoutLocal, returnValIfTimeout) => new Promise((resolve) => {\n  const listener = (event) => {\n    // eslint-disable-next-line no-use-before-define\n    clearTimeout(timer);\n    resolve(event.detail);\n  };\n\n  const errorListener = () => {\n    // eslint-disable-next-line no-use-before-define\n    clearTimeout(timer);\n    resolve({ error: true });\n  };\n\n  const timer = setTimeout(() => {\n    window.removeEventListener(eventName, listener);\n    if (returnValIfTimeout !== undefined) {\n      resolve(returnValIfTimeout);\n    } else {\n      resolve({ timeout: true });\n    }\n  }, timeoutLocal);\n\n  window.addEventListener(eventName, listener, { once: true });\n  window.addEventListener(ALLOY_SEND_EVENT_ERROR, errorListener, { once: true });\n});\n\nfunction roundToQuarter(num) {\n  return Math.ceil(num / 250) / 4;\n}\n\nfunction calculateResponseTime(responseStart) {\n  const responseTime = Date.now() - responseStart;\n  return roundToQuarter(responseTime);\n}\n\nexport const getTargetPersonalization = async (\n  { handleAlloyResponse, sendTargetResponseAnalytics },\n) => {\n  const responseStart = Date.now();\n  window.addEventListener(ALLOY_SEND_EVENT, () => {\n    const responseTime = calculateResponseTime(responseStart);\n    try {\n      window.lana.log(`target response time: ${responseTime}`, { tags: 'martech', errorType: 'i' });\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.error('Error logging target response time:', e);\n    }\n  }, { once: true });\n\n  let targetManifests = [];\n  let targetPropositions = [];\n\n  const response = await waitForEventOrTimeout(ALLOY_SEND_EVENT, timeout);\n  if (response.error) {\n    try {\n      window.lana.log('target response time: ad blocker', { tags: 'martech', errorType: 'i' });\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.error('Error logging target response time for ad blocker:', e);\n    }\n    return { targetManifests, targetPropositions };\n  }\n  if (response.timeout) {\n    waitForEventOrTimeout(ALLOY_SEND_EVENT, 5100 - timeout)\n      .then(() => sendTargetResponseAnalytics(true, responseStart, timeout));\n  } else {\n    sendTargetResponseAnalytics(false, responseStart, timeout);\n    targetManifests = handleAlloyResponse(response.result);\n    targetPropositions = response.result?.propositions || [];\n  }\n\n  return { targetManifests, targetPropositions };\n};\n\nconst setupEntitlementCallback = () => {\n  const setEntitlements = async (destinations) => {\n    const { getEntitlements } = await import('../features/personalization/personalization.js');\n    return getEntitlements(destinations);\n  };\n\n  const getEntitlements = (resolve) => {\n    const handleEntitlements = (detail) => {\n      if (detail?.result?.destinations?.length) {\n        resolve(setEntitlements(detail.result.destinations));\n      } else {\n        resolve([]);\n      }\n    };\n    waitForEventOrTimeout(ALLOY_SEND_EVENT, ENTITLEMENT_TIMEOUT, [])\n      .then(handleEntitlements)\n      .catch(() => resolve([]));\n  };\n\n  const { miloLibs, codeRoot, entitlements: resolveEnt } = getConfig();\n  getEntitlements(resolveEnt);\n\n  loadLink(\n    `${miloLibs || codeRoot}/features/personalization/personalization.js`,\n    { as: 'script', rel: 'modulepreload' },\n  );\n};\n\nfunction isProxied() {\n  return /^(www|milo|business|blog|news)(\\.stage)?\\.adobe\\.com$/.test(window.location.hostname);\n}\n\nlet filesLoadedPromise = false;\nconst loadMartechFiles = async (config) => {\n  if (filesLoadedPromise) return filesLoadedPromise;\n\n  filesLoadedPromise = async () => {\n    if (getMepEnablement('xlg') === 'loggedout') {\n      setupEntitlementCallback();\n    } else {\n      loadIms()\n        .then(() => {\n          if (window.adobeIMS.isSignedInUser()) setupEntitlementCallback();\n        })\n        .catch(() => { });\n    }\n\n    setDeep(\n      window,\n      'alloy_all.data._adobe_corpnew.digitalData.page.pageInfo.language',\n      { locale: config.locale.prefix.replace('/', ''), langCode: config.locale.ietf },\n    );\n    setDeep(window, 'digitalData.diagnostic.franklin.implementation', 'milo');\n\n    const launchUrl = config.env.consumer?.marTechUrl || (\n      isProxied()\n        ? '/marketingtech'\n        : 'https://assets.adobedtm.com'\n    ) + (\n      config.env.name === 'prod'\n        ? '/d4d114c60e50/a0e989131fd5/launch-5dd5dd2177e6.min.js'\n        : '/d4d114c60e50/a0e989131fd5/launch-2c94beadc94f-development.min.js'\n    );\n    loadLink(launchUrl, { as: 'script', rel: 'preload' });\n\n    window.marketingtech = {\n      adobe: {\n        launch: {\n          url: launchUrl,\n          controlPageLoad: true,\n        },\n        alloy: {\n          edgeConfigId: config.env.consumer?.edgeConfigId || config.env.edgeConfigId,\n          edgeDomain: (\n            isProxied()\n              ? window.location.hostname\n              : 'sstats.adobe.com'\n          ),\n          edgeBasePath: (\n            isProxied()\n              ? 'experienceedge'\n              : 'ee'\n          ),\n        },\n        target: false,\n      },\n      milo: true,\n    };\n    window.edgeConfigId = config.env.edgeConfigId;\n\n    await loadScript((\n      isProxied()\n        ? ''\n        : 'https://www.adobe.com'\n    ) + (\n      config.env.name === 'prod'\n        ? '/marketingtech/main.standard.min.js'\n        : '/marketingtech/main.standard.qa.min.js'\n    ));\n    // eslint-disable-next-line no-underscore-dangle\n    window._satellite.track('pageload');\n  };\n\n  await filesLoadedPromise();\n  return filesLoadedPromise;\n};\n\nexport default async function init() {\n  const config = getConfig();\n  const martechPromise = loadMartechFiles(config);\n  return martechPromise;\n}\n"],"names":["ALLOY_SEND_EVENT","params","URL","window","location","href","searchParams","timeout","parseInt","get","getMetadata","setDeep","obj","path","value","pathArr","split","currentObj","key","slice","length","waitForEventOrTimeout","eventName","timeoutLocal","returnValIfTimeout","Promise","resolve","listener","event","clearTimeout","timer","detail","setTimeout","removeEventListener","addEventListener","once","errorListener","error","calculateResponseTime","responseStart","responseTime","Date","now","num","Math","ceil","getTargetPersonalization","async","handleAlloyResponse","sendTargetResponseAnalytics","_ref","lana","log","concat","tags","errorType","e","console","targetManifests","targetPropositions","response","_response$result","then","result","propositions","setupEntitlementCallback","miloLibs","codeRoot","entitlements","resolveEnt","getConfig","_detail$result","destinations","getEntitlements","getEntitlements2","setEntitlements","catch","loadLink","as","rel","isProxied","test","hostname","filesLoadedPromise","loadMartechFiles","_config$env$consumer","_config$env$consumer2","getMepEnablement","loadIms","adobeIMS","isSignedInUser","locale","config","prefix","replace","langCode","ietf","launchUrl","env","consumer","marTechUrl","name","marketingtech","adobe","launch","url","controlPageLoad","alloy","edgeConfigId","edgeDomain","edgeBasePath","target","milo","loadScript","_satellite","track","init"],"sourceRoot":""}