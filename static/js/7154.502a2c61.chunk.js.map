{"version":3,"file":"static/js/7154.502a2c61.chunk.js","mappings":"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","sources":["../node_modules/@adobecom/martech/martech.js"],"sourcesContent":["import {\n  getConfig, loadIms, loadLink, loadScript, getMepEnablement, getMetadata,\n} from '../utils/utils.js';\n\nconst ALLOY_PROPOSITION_FETCH = 'alloy_propositionFetch';\nconst ALLOY_SEND_EVENT = 'alloy_sendEvent';\nconst ALLOY_SEND_EVENT_ERROR = 'alloy_sendEvent_error';\nconst ENTITLEMENT_TIMEOUT = 3000;\n\nconst TARGET_TIMEOUT_MS = 4000;\nconst params = new URL(window.location.href).searchParams;\nconst timeout = parseInt(params.get('target-timeout'), 10)\n  || parseInt(getMetadata('target-timeout'), 10)\n  || TARGET_TIMEOUT_MS;\n\nconst setDeep = (obj, path, value) => {\n  const pathArr = path.split('.');\n  let currentObj = obj;\n\n  for (const key of pathArr.slice(0, -1)) {\n    if (!currentObj[key] || typeof currentObj[key] !== 'object') {\n      currentObj[key] = {};\n    }\n    currentObj = currentObj[key];\n  }\n\n  currentObj[pathArr[pathArr.length - 1]] = value;\n};\n\n// eslint-disable-next-line max-len\nconst waitForEventOrTimeout = (eventName, timeoutLocal, returnValIfTimeout) => new Promise((resolve) => {\n  const listener = (event) => {\n    // eslint-disable-next-line no-use-before-define\n    clearTimeout(timer);\n    resolve(event.detail);\n  };\n\n  const errorListener = () => {\n    // eslint-disable-next-line no-use-before-define\n    clearTimeout(timer);\n    resolve({ error: true });\n  };\n\n  const timer = setTimeout(() => {\n    window.removeEventListener(eventName, listener);\n    if (returnValIfTimeout !== undefined) {\n      resolve(returnValIfTimeout);\n    } else {\n      resolve({ timeout: true });\n    }\n  }, timeoutLocal);\n\n  const eventError = eventName\n    === ALLOY_SEND_EVENT ? ALLOY_SEND_EVENT_ERROR : ALLOY_PROPOSITION_FETCH;\n  window.addEventListener(eventName, listener, { once: true });\n  window.addEventListener(eventError, errorListener, { once: true });\n});\n\nfunction roundToQuarter(num) {\n  return Math.ceil(num / 250) / 4;\n}\n\nfunction calculateResponseTime(responseStart) {\n  const responseTime = Date.now() - responseStart;\n  return roundToQuarter(responseTime);\n}\n\nexport const getTargetAjoPersonalization = async (\n  { handleAlloyResponse, config, sendTargetResponseAnalytics },\n) => {\n  const responseStart = Date.now();\n  const ajo = config.mep.ajoEnabled;\n  const eventName = ajo ? ALLOY_PROPOSITION_FETCH : ALLOY_SEND_EVENT;\n  const targetAjo = ajo ? 'ajo' : 'target';\n  window.addEventListener(eventName, () => {\n    const responseTime = calculateResponseTime(responseStart);\n    try {\n      window.lana.log(`target response time: ${responseTime}`, {\n        tags: 'martech',\n        errorType: 'e',\n        sampleRate: 0.5,\n      });\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.error('Error logging target response time:', e);\n    }\n  }, { once: true });\n\n  let targetAjoManifests = [];\n  let targetAjoPropositions = [];\n\n  const response = await waitForEventOrTimeout(eventName, timeout);\n\n  if (response.error) {\n    try {\n      window.lana.log(`${targetAjo} response time: ad blocker`, {\n        tags: 'martech',\n        errorType: 'e',\n        sampleRate: 0.5,\n      });\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.error(`Error logging ${targetAjo} response time for ad blocker:`, e);\n    }\n    return { targetAjoManifests, targetAjoPropositions };\n  }\n  if (response.timeout) {\n    waitForEventOrTimeout(eventName, 5100 - timeout)\n      .then(() => sendTargetResponseAnalytics(true, responseStart, timeout));\n  } else {\n    sendTargetResponseAnalytics(false, responseStart, timeout);\n    targetAjoManifests = handleAlloyResponse(response.result);\n    targetAjoPropositions = response.result?.propositions || [];\n  }\n\n  return { targetAjoManifests, targetAjoPropositions };\n};\n\nconst setupEntitlementCallback = () => {\n  const setEntitlements = async (destinations) => {\n    const { getEntitlements } = await import('../features/personalization/personalization.js');\n    return getEntitlements(destinations);\n  };\n\n  const getEntitlements = (resolve) => {\n    const handleEntitlements = (detail) => {\n      if (detail?.result?.destinations?.length) {\n        resolve(setEntitlements(detail.result.destinations));\n      } else {\n        resolve([]);\n      }\n    };\n    waitForEventOrTimeout(ALLOY_SEND_EVENT, ENTITLEMENT_TIMEOUT, [])\n      .then(handleEntitlements)\n      .catch(() => resolve([]));\n  };\n\n  const { miloLibs, codeRoot, entitlements: resolveEnt } = getConfig();\n  getEntitlements(resolveEnt);\n\n  loadLink(\n    `${miloLibs || codeRoot}/features/personalization/personalization.js`,\n    { as: 'script', rel: 'modulepreload' },\n  );\n};\n\nfunction isProxied() {\n  return /^(www|milo|business|blog|news)(\\.stage)?\\.adobe\\.com$/.test(window.location.hostname);\n}\n\nlet filesLoadedPromise = false;\nconst loadMartechFiles = async (config) => {\n  if (filesLoadedPromise) return filesLoadedPromise;\n\n  filesLoadedPromise = async () => {\n    if (getMepEnablement('xlg') === 'loggedout') {\n      setupEntitlementCallback();\n    } else {\n      loadIms()\n        .then(() => {\n          if (window.adobeIMS.isSignedInUser()) setupEntitlementCallback();\n        })\n        .catch(() => { });\n    }\n\n    setDeep(\n      window,\n      'alloy_all.data._adobe_corpnew.digitalData.page.pageInfo.language',\n      { locale: config.locale.prefix.replace('/', ''), langCode: config.locale.ietf },\n    );\n    setDeep(window, 'digitalData.diagnostic.franklin.implementation', 'milo');\n\n    const launchUrl = config.env.consumer?.marTechUrl || (\n      isProxied()\n        ? '/marketingtech'\n        : 'https://assets.adobedtm.com'\n    ) + (\n      config.env.name === 'prod'\n        ? '/d4d114c60e50/a0e989131fd5/launch-5dd5dd2177e6.min.js'\n        : '/d4d114c60e50/a0e989131fd5/launch-2c94beadc94f-development.min.js'\n    );\n    loadLink(launchUrl, { as: 'script', rel: 'preload' });\n\n    window.marketingtech = {\n      adobe: {\n        launch: {\n          url: launchUrl,\n          controlPageLoad: true,\n        },\n        alloy: {\n          edgeConfigId: config.env.consumer?.edgeConfigId || config.env.edgeConfigId,\n          edgeDomain: (\n            isProxied()\n              ? window.location.hostname\n              : 'sstats.adobe.com'\n          ),\n          edgeBasePath: (\n            isProxied()\n              ? 'experienceedge'\n              : 'ee'\n          ),\n        },\n        target: false,\n      },\n      milo: true,\n    };\n    window.edgeConfigId = config.env.edgeConfigId;\n\n    await loadScript((\n      isProxied()\n        ? ''\n        : 'https://www.adobe.com'\n    ) + (\n      config.env.name === 'prod'\n        ? '/marketingtech/main.standard.min.js'\n        : '/marketingtech/main.standard.qa.min.js'\n    ));\n    // eslint-disable-next-line no-underscore-dangle\n    window._satellite.track('pageload');\n  };\n\n  await filesLoadedPromise();\n  return filesLoadedPromise;\n};\n\nexport default async function init() {\n  const config = getConfig();\n  const martechPromise = loadMartechFiles(config);\n  return martechPromise;\n}\n"],"names":["ALLOY_PROPOSITION_FETCH","ALLOY_SEND_EVENT","params","URL","window","location","href","searchParams","timeout","parseInt","get","getMetadata","setDeep","obj","path","value","pathArr","split","currentObj","key","slice","length","waitForEventOrTimeout","eventName","timeoutLocal","returnValIfTimeout","Promise","resolve","listener","event","clearTimeout","timer","detail","setTimeout","removeEventListener","eventError","addEventListener","once","errorListener","error","calculateResponseTime","responseStart","responseTime","Date","now","num","Math","ceil","getTargetAjoPersonalization","async","handleAlloyResponse","config","sendTargetResponseAnalytics","_ref","ajo","mep","ajoEnabled","targetAjo","lana","log","concat","tags","errorType","sampleRate","e","console","targetAjoManifests","targetAjoPropositions","response","_response$result","then","result","propositions","setupEntitlementCallback","miloLibs","codeRoot","entitlements","resolveEnt","getConfig","_detail$result","destinations","getEntitlements","getEntitlements2","setEntitlements","catch","loadLink","as","rel","isProxied","test","hostname","filesLoadedPromise","loadMartechFiles","_config$env$consumer","_config$env$consumer2","getMepEnablement","loadIms","adobeIMS","isSignedInUser","locale","prefix","replace","langCode","ietf","launchUrl","env","consumer","marTechUrl","name","marketingtech","adobe","launch","url","controlPageLoad","alloy","edgeConfigId","edgeDomain","edgeBasePath","target","milo","loadScript","_satellite","track","init"],"sourceRoot":""}