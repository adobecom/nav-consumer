"use strict";(self.webpackChunknav_consumer=self.webpackChunknav_consumer||[]).push([[8269],{8269:(e,t,n)=>{n.r(t),n.d(t,{API_URLS:()=>s,default:()=>C,getMepPopup:()=>g,parsePageAndUrl:()=>r,saveToMmm:()=>y});var a,c=n(5771),i=(n(6715),n(1608)),o=(n(3658),"https://jvdtssh5lkvwwi4y3kbletjmvu0qctxj.lambda-url.us-west-2.on.aws"),s={pageList:"".concat(o,"/get-pages"),pageDetails:"".concat(o,"/get-page"),pageDataByURL:"".concat(o,"/get-page?url="),save:"".concat(o,"/save-mep-call"),report:"".concat(o,"/get-report")};function l(e,t){const n=e.querySelectorAll('option:checked, input[type="text"]'),a=[];n.forEach((e=>{var t;const n=null===(t=e.closest("select"))||void 0===t?void 0:t.disabled;if(!e.value||n)return;let{value:c}=e;if(e.classList.contains("new-manifest")&&c)try{c=new URL(c).pathname||c}catch{}else c="".concat(e.dataset.manifest,"--").concat(c);a.push(c)}));const c=t.length?e.closest("[data-url]").dataset.url:window.location.href,i=new URL(c);i.searchParams.set("mep",a.join("---"));const o=e.querySelector('input[type="checkbox"]#mepHighlightCheckbox'.concat(t));document.body.dataset.mepHighlight=o.checked,o.checked?i.searchParams.set("mepHighlight",!0):i.searchParams.delete("mepHighlight");e.querySelector('input[type="checkbox"]#mepPreviewButtonCheckbox'.concat(t)).checked?i.searchParams.set("mepButton","off"):i.searchParams.delete("mepButton"),e.querySelector("a.con-button").setAttribute("href",i.href)}function d(e,t){e.querySelectorAll(t).forEach((e=>{const t=(0,i.createTag)("div",{class:"mep-divider"});e.insertAdjacentElement("afterend",t)}))}function r(e,t,n){const{stageDomainsMap:a,env:c}=e,{pathname:i,origin:o}=t,s=["business.stage.adobe.com","www.stage.adobe.com","milo.stage.adobe.com"];if("prod"===(null===c||void 0===c?void 0:c.name)||!a||s.includes(o.replace("https://",""))){const e=o.replace("stage.adobe.com","adobe.com");return{page:i.replace("/".concat(n,"/"),"/"),url:"".concat(e).concat(i)}}let l=i,d=o;const r=Object.keys(a).find((e=>{try{const{host:t}=new URL("https://".concat(e));return s.includes(t)}catch(t){return!1}}));return r&&(d="https://".concat(r)),l=l.replace("/homepage/index-loggedout","/"),l.endsWith("/")||l.endsWith(".html")||d.includes("milo")||(l+=".html"),d=d.replace("stage.adobe.com","adobe.com"),{page:l.replace("/".concat(n,"/"),"/"),url:"".concat(d).concat(l)}}function p(){const e=(0,i.getConfig)(),{mep:t,locale:n}=e,{experiments:a,prefix:o,highlight:s}=t,l=a.map((e=>{const{name:t,event:n,manifest:a,variantNames:c,selectedVariantName:i,disabled:o,analyticsTitle:s,source:l,geoRestriction:d,mktgAction:r}=e;let p=a;try{p=new URL(a).pathname}catch(v){}return{targetActivityName:t,variantNames:c,selectedVariantName:i,url:a,disabled:o,source:l,eventStart:null===n||void 0===n?void 0:n.start,eventEnd:null===n||void 0===n?void 0:n.end,pathname:p,analyticsTitle:s,geoRestriction:d,mktgAction:r}})),{page:d,url:p}=r(e,window.location,o);return{page:{url:p,page:d,target:(0,i.getMetadata)("target")||"off",personalization:(0,i.getMetadata)("personalization")?"on":"off",geo:o===c.US_GEO?"":o,locale:n.ietf,region:n.region,highlight:s},activities:l}}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local";if(!e)return"";let n=e;if("string"===typeof n&&(n=new Date(n)),"iso"===t)return n.toISOString();const a=n.toLocaleDateString(!1,{year:"numeric",month:"short",day:"numeric"}),c=n.toLocaleTimeString(!1,{timeStyle:"short"});return"".concat(a," ").concat(c)}function m(e){const{activities:t,page:n}=e,{pageId:a=0}=n;let i="";const o=[];return null===t||void 0===t||t.forEach(((e,t)=>{const{variantNames:n,manifestPath:s=e.url,selectedVariantName:l=e.selectedVariantName||"default",manifestUrl:d,targetActivityName:r,source:p,analyticsTitle:m,eventStart:u,eventEnd:h,disabled:f,geoRestriction:g,mktgAction:b}=e,y=d||s,C=(0,c.normalizePath)(y),w="string"===typeof n?n.split("||"):n;let L="",k="";n.includes(l)||0!==a||(k="selected",o.push("".concat(y,"--default"))),L+='<option name="'.concat(C).concat(a,'" value="" title="none">None (Don\'t add manifest)</option>'),L+='<option name="'.concat(C).concat(a,'" value="default" \n    id="').concat(C).concat(a,'--default" data-manifest="').concat(C,'" ').concat(k,' title="Default (control)">Default (control)</option>'),k="",w.forEach((e=>{k="",e===l&&(k="selected",o.push("".concat(s,"--").concat(e))),L+='<option name="'.concat(C).concat(a,'" value="').concat(e,'" \n      id="').concat(C).concat(a,"--").concat(e,'" data-manifest="').concat(C,'" ').concat(k,' title="').concat(e,'">').concat(e,"</option>")})),i+='<div class="mep-section" title="Manifest location: '.concat(y,"&#013;Analytics manifest name: ").concat(m||"N/A for this manifest type",'">\n      <div class="mep-manifest-info">  \n          <a class="mep-edit-manifest" href="').concat(y,'" target="_blank" title="Open manifest">\n          ').concat(t+1,". ").concat((0,c.getFileName)(s),"\n          </a>\n          ").concat(r?'<div class="target-activity-name">'.concat(r||"","</div>"):"",'\n          <div class="mep-columns">\n            <div class="mep-column">\n              <div class="mep-active">Experience</div>\n              <div>Source</div>\n              <div>Mktg action</div>\n              ').concat(g?"<div>Geos</div>":"","\n              ").concat(u&&h||f?"<div>Active?</div>":"","\n              ").concat(e.lastSeen?"<div>Last seen</div>":"",'\n            </div>\n            <div class="mep-column">\n              ').concat(n.includes(l)?"<div class='mep-selected-variant mep-active'>".concat(l,"</div>"):'<div class="mep-active">default (control)</div>',"\n              <div>").concat(p,"</div>\n              <div>").concat(b,"</div>\n              ").concat(g?"<div>".concat(null===g||void 0===g?void 0:g.toUpperCase(),"</div>"):"","\n              ").concat(u&&h||f?"<div>".concat(f?"inactive":"active","</div>"):"","\n              ").concat(e.lastSeen?"<div>".concat(v(new Date(e.lastSeen)),"</div>"):"","\n            </div>\n          </div>\n          ").concat(u&&h?'<div class="mep-columns">\n            <div class="mep-column">\n              <div>On</div>\n              <div>Off</div>\n            </div>\n            <div class="mep-column">\n              <div>'.concat(v(u),' <a target= "_blank" href="?instant=').concat(v(u,"iso"),'">Instant</a></div>\n              <div>').concat(v(h),"</div>\n            </div>\n          </div>\n        </div>"):"",'\n        <div class="mep-experience-dropdown">\n          <label for="experiences">Experience</label>\n          <select name="experiences" class="mep-manifest-variants">').concat(L,"</select>\n        </div>\n      </div>\n    </div>")})),{manifestList:i,manifestParameter:o}}function u(e){return'\n    <span class="mep-open"></span>\n    <div class="mep-manifest-count">'.concat(e||0," ").concat(e>1?"Manifests":"Manifest"," found</div>\n  ")}async function h(e,t,n){const i=p(),o=document.querySelector(".mep-manifest-list.mmm-list");if(!a)try{const e="".concat(s.pageDataByURL).concat(i.page.url,"&lastSeen=week"),r=await fetch(e);if(!r.ok)throw new Error("Network error");const p=await r.json();p&&((a=p).activities=a.activities.filter((e=>!i.activities.some((t=>(0,c.normalizePath)(t.url)===(0,c.normalizePath)(e.url))))).map((e=>(e.source="MMM",e))),o.innerHTML="<h6>MMM data for last 7 days</h6> ".concat(m(p).manifestList),o.querySelectorAll("select").forEach((e=>{e.querySelector('option[title="none"]').selected=!0,e.addEventListener("change",l.bind(null,t,n))})),d(o,".mep-section"))}catch(h){console.error("Error fetching 7-day page data:",h)}const r=document.querySelector(".mep-manifest.mep-badge");var v;e.target.checked&&a?(o.classList.add("mep-show"),o.querySelectorAll("select").forEach((e=>{e.disabled=!1})),r.innerHTML=u(a.activities.length+i.activities.length)):(o.classList.remove("mep-show"),o.querySelectorAll("select").forEach((e=>{e.disabled=!0})),r.innerHTML=u(null===(v=i.activities)||void 0===v?void 0:v.length))}function f(e,t){e.querySelectorAll('select, input[type="checkbox"]').forEach((n=>{n.addEventListener("change",l.bind(null,e,t))})),e.querySelectorAll('input[type="text"]').forEach((n=>{n.addEventListener("keyup",l.bind(null,e,t)),n.addEventListener("change",l.bind(null,e,t))})),e.querySelectorAll("#mepManifestsCheckbox").forEach((n=>{n.addEventListener("change",(n=>h.bind(null,n,e,t)())),n.addEventListener("change",l.bind(null,e,t))}))}function g(e){var t,n,a,c;let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{page:s}=e,r=null!==s&&void 0!==s&&s.pageId?"-".concat(s.pageId):"",{manifestList:p}=m(e);let u="";null!==s&&void 0!==s&&s.highlight&&(u='checked="checked"',document.body.dataset.mepHighlight=!0);const h="preview-button",g=o?s.url:new URL(window.location.href).href,b=(0,i.createTag)("div",{class:"mep-popup".concat(o?"":" in-page"),"data-url":g}),y=(0,i.createTag)("div",{class:"mep-popup-header"}),C=(0,i.createTag)("div",{class:"mep-section"}),w=(0,i.createTag)("div",{class:"mep-section"}),L=(0,i.createTag)("div",{class:"mep-popup-body"}),k=(0,i.createTag)("div",{class:"mep-manifest-list"}),S=(0,i.createTag)("div",{class:"mep-manifest-list mmm-list"}),M=(0,i.getConfig)(),E={postlcp:"postlcp",true:"on",false:"off"}[null===(t=M.mep)||void 0===t?void 0:t.targetEnabled],x=function(e,t){return void 0===e?t.target:"postlcp"===e?"on post LCP":e}(o?s.target:E,s),{akamaiCode:T,consentState:H}=M.mep;C.innerHTML='\n    <h6 class="mep-manifest-page-info-title">Page Info</h6>\n    <div class="mep-columns">\n      <div class="mep-column">\n        <div>Target Integration</div>\n        <div>Personalization</div>\n        <div>Geo Folder</div>\n        <div>Locale</div>\n        '.concat(s.lastSeen?"<div>Last Seen</div>":"",'\n      </div>\n      <div class="mep-column">\n        <div>').concat(x,"</div>\n        <div>").concat(s.personalization,"</div>\n        <div>").concat(s.geo||"Nothing (US)","</div>\n        <div>").concat(null===(n=s.locale)||void 0===n?void 0:n.toLowerCase(),"</div>\n        ").concat(s.lastSeen?"<div>".concat(v(new Date(s.lastSeen)),"</div>"):"",'\n      </div>\n    </div>\n    <h6 class="mep-manifest-page-info-title">User Info</h6>\n    <div class="mep-columns">\n      <div class="mep-column">\n        <div>Country</div>\n        <div>Functional consent</div>\n        <div>Advertising consent</div>\n      </div>\n      <div class="mep-column">\n        <div>').concat(T,"</div>\n        <div>").concat(H.performance?"on":"off","</div>\n        <div>").concat(H.advertising?"on":"off","</div>\n      </div>\n    </div>\n    ");const A="prod"!==(null===(a=M.env)||void 0===a?void 0:a.name)||o?"":'<div>\n        <input type="checkbox" name="mepHighlight'.concat(r,'"\n        id="mepManifestsCheckbox" value="false">\n        <label for="mepManifestsCheckbox">MMM data for last 7 days</label>\n      </div>');w.innerHTML='\n    <h6 class="mep-manifest-page-info-title">Options</h6>\n    <div class="mep-manifest-variants">\n      <div>\n        <input type="checkbox" name="mepHighlight'.concat(r,'"\n        id="mepHighlightCheckbox').concat(r,'" ').concat(u,' value="true">\n        <label for="mepHighlightCheckbox').concat(r,'">Highlight changes</label>\n      </div>\n      ').concat(A,'\n      <div>\n        <input type="checkbox" name="mepPreviewButtonCheckbox').concat(r,'"\n        id="mepPreviewButtonCheckbox').concat(r,'" value="off">\n        <label for="mepPreviewButtonCheckbox').concat(r,'">Add mepButton=off to preview link</label>\n      </div>\n    </div>\n    <div>New manifest location or path*</div>\n    <input type="text" name="new-manifest').concat(r,'" class="new-manifest">');const P=(0,i.createTag)("div",{class:"mep-popup-footer".concat(o?"":" dark")});P.innerHTML+='\n    <a class="con-button outline button-l" data-id="'.concat(h,'" title="Preview above choices" ').concat(o?' target="_blank"':"",">Preview</a>");const q='<svg width="33" height="21" viewBox="0 0 33 21" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M22.8359 20.9998H18.0635C17.8561 21.0036 17.6523 20.9458 17.478 20.8338C17.3037 20.7219 17.1669 20.5607 17.0849 20.371L11.9039 8.30626C11.8958 8.27747 11.8821 8.25055 11.8636 8.22704C11.845 8.20353 11.822 8.18389 11.7958 8.16924C11.7696 8.1546 11.7408 8.14523 11.711 8.14167C11.6812 8.13812 11.651 8.14044 11.6221 8.14852L11.617 8.15001C11.5806 8.1604 11.5475 8.17958 11.5204 8.20585C11.4934 8.23212 11.4733 8.26466 11.462 8.30055L8.23347 15.9607C8.20525 16.0273 8.20475 16.1023 8.23207 16.1692C8.25939 16.2362 8.31229 16.2896 8.37914 16.3177L8.37983 16.318C8.41348 16.3319 8.44957 16.339 8.486 16.3389H12.035C12.1425 16.3389 12.2477 16.3704 12.3373 16.4295C12.427 16.4887 12.4972 16.5728 12.5391 16.6715L14.0926 20.1157C14.1588 20.2708 14.1603 20.4457 14.097 20.602C14.0336 20.7583 13.9105 20.8831 13.7548 20.949L13.754 20.9493C13.6753 20.9826 13.5907 20.9998 13.5053 20.9998H0.58545C0.488275 20.9993 0.392732 20.9749 0.307356 20.9287C0.22198 20.8824 0.149429 20.8159 0.0961835 20.7349C0.0429379 20.6539 0.0106559 20.5611 0.00222085 20.4647C-0.00621415 20.3683 0.00946049 20.2713 0.0478448 20.1824L8.26598 0.690892C8.35033 0.483823 8.49562 0.307024 8.68274 0.183739C8.86987 0.0604533 9.09007 -0.00354744 9.31441 0.000151769H14.0543C14.2779 -0.0028459 14.4972 0.0615004 14.6834 0.184758C14.8697 0.308015 15.0142 0.484433 15.098 0.690892L23.3726 20.1824C23.4107 20.2712 23.4263 20.3681 23.4178 20.4644C23.4094 20.5606 23.3771 20.6533 23.324 20.7342C23.2709 20.8151 23.1986 20.8817 23.1134 20.928C23.0283 20.9744 22.933 20.999 22.8359 20.9998Z" fill="white"/>\n    <path d="M27.6434 20.9998H32.4159C32.5129 20.999 32.6082 20.9744 32.6934 20.928C32.7785 20.8817 32.8509 20.8151 32.904 20.7342C32.9571 20.6533 32.9893 20.5606 32.9978 20.4644C33.0062 20.3681 32.9907 20.2712 32.9525 20.1824L24.6779 0.690892C24.5941 0.484433 24.4496 0.308015 24.2634 0.184758C24.0771 0.0615004 23.8579 -0.0028459 23.6343 0.000151769H18.8943C18.67 -0.00354743 18.4498 0.0604533 18.2627 0.183739C18.0756 0.307024 17.38 1.16222 17.2956 1.36928L20.4916 8.97894C20.503 8.94305 21.0733 8.23212 21.1004 8.20585C21.1274 8.17958 21.1606 8.1604 21.1969 8.15001L21.202 8.14852C21.2309 8.14044 21.2611 8.13812 21.2909 8.14167C21.3207 8.14523 21.3496 8.1546 21.3757 8.16924C21.4019 8.18389 21.4249 8.20353 21.4435 8.22704C21.462 8.25055 21.4758 8.27747 21.4839 8.30626L26.6648 20.371C26.7468 20.5607 26.8837 20.7219 27.058 20.8338C27.2322 20.9458 27.436 21.0036 27.6434 20.9998Z" fill="white"/>\n    </svg>',N=o?q:'<a href="https://main--milo--adobecom.aem.page/docs/authoring/features/mmm" title="Open Mep Manifest Manager" target="_blank" >'.concat(q,"</a>");y.innerHTML="\n    ".concat(N,'\n    <span class="mep-close"></span>'),k.innerHTML="<h6>Page Manifests</h6>".concat(p),C&&L.append(C),k&&L.append(k),S&&"prod"===(null===(c=M.env)||void 0===c?void 0:c.name)&&L.append(S),w&&L.append(w),b.append(y),b.append(L),b.append(P),d(b,".mep-popup-body > .mep-section:not(:last-child), .mep-manifest-list > .mep-section");return b.querySelector('a[data-id="'.concat(h,'"]'))&&l(b,r),f(b,r),b}function b(){const e=p(),{activities:t}=e,n=(0,i.createTag)("div",{class:"mep-preview-overlay static-links",style:"display: none;"}),a=document.createElement("div");a.classList.add("mep-hidden");const c=(0,i.createTag)("div",{class:"mep-manifest mep-badge"});var o;c.innerHTML=u(null===t||void 0===t?void 0:t.length),a.append(c),a.append(g(e)),n.append(a),document.body.append(n),(o=a).querySelector(".mep-manifest.mep-badge").addEventListener("click",(()=>{o.classList.toggle("mep-hidden")})),o.querySelector(".mep-close").addEventListener("click",(()=>{document.body.removeChild(document.querySelector(".mep-preview-overlay"))}))}async function y(){const e=p();return!["/drafts/",".stage.",".page/",".live/","/fragments/","/nala/"].some((t=>e.page.url.includes(t)))&&(e.activities=e.activities.filter((e=>{var t;const{url:n,source:a}=e;return e.source=a.filter((e=>"mep param"!==e)),!(null===(t=e.source)||void 0===t||!t.length||n.includes("/drafts/"))})),e.activities=e.activities.map((e=>{var t,n;return e.variantNames=(null===(t=e.variantNames)||void 0===t?void 0:t.join("||"))||"",e.source=(null===(n=e.source)||void 0===n?void 0:n.join(","))||"",delete e.selectedVariantName,e})),e.page.prefix===c.US_GEO&&(e.page.prefix=""),e.page.target=(0,i.getMetadata)("target")||"off",delete e.page.highlight,fetch(s.save,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((async e=>{const t=await e.json();if(e.ok)return t;throw new Error(t.message||"Network response failed")})))}async function C(){const{miloLibs:e,codeRoot:t,mep:n}=(0,i.getConfig)();(0,i.loadStyle)("".concat(e||t,"/features/personalization/preview.css")),b(),null!==n&&void 0!==n&&n.experiments&&n.experiments.forEach((e=>{var t,n,a;let{selectedVariant:i,manifest:o}=e;const s=(0,c.getFileName)(o),l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"manifestId";document.querySelectorAll(e).forEach((e=>e.dataset[t]=s))};null===i||void 0===i||null===(t=i.replacefragment)||void 0===t||t.forEach((e=>{let{val:t}=e;return l('[data-path*="'.concat(t,'"]'))})),null===i||void 0===i||null===(n=i.useblockcode)||void 0===n||n.forEach((e=>{let{selector:t}=e;t&&l(".".concat(t),"codeManifestId")})),null===i||void 0===i||null===(a=i.updatemetadata)||void 0===a||a.forEach((e=>{let{selector:t}=e;"gnav-source"===t&&l("header, footer")})),document.querySelectorAll('.section[class*="merch-cards"] .fragment[data-manifest-id="'.concat(s,'"] merch-card')).forEach((e=>e.dataset.manifestId=s))}))}}}]);
//# sourceMappingURL=8269.f5910de5.chunk.js.map