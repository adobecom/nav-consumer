{"version":3,"file":"static/js/3286.1cd5f706.chunk.js","mappings":"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","sources":["../node_modules/@adobecom/standalone-feds/dist|lazy|/^.*//features//spectrum/-web/-components//dist//progress/-circle/.js$/|groupOptions: {}|strict namespace object","../node_modules/@adobecom/standalone-feds/dist|lazy|/^.*//features//spectrum/-web/-components//dist//theme/.js$/|groupOptions: {}|strict namespace object","../node_modules/@adobecom/features/placeholders.js","../node_modules/@adobecom/blocks/merch/upgrade.js"],"sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(() => {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = () => ([]);\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 3664;\nmodule.exports = webpackEmptyAsyncContext;","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(() => {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = () => ([]);\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 4417;\nmodule.exports = webpackEmptyAsyncContext;","import { customFetch, getConfig, getMetadata } from '../utils/utils.js';\n\nconst fetchedPlaceholders = {};\nwindow.mph = {};\n\nconst getPlaceholdersPath = (config, sheet) => {\n  const path = `${config.locale.contentRoot}/placeholders.json`;\n  const query = sheet !== 'default' && typeof sheet === 'string' && sheet.length ? `?sheet=${sheet}` : '';\n  return `${path}${query}`;\n};\n\nconst fetchPlaceholders = async ({ config, sheet, placeholderRequest, placeholderPath }) => {\n  const path = placeholderPath || getPlaceholdersPath(config, sheet);\n  // eslint-disable-next-line no-async-promise-executor\n  fetchedPlaceholders[path] = fetchedPlaceholders[path] || new Promise(async (resolve) => {\n    const resp = await placeholderRequest || await customFetch(\n      { resource: path, withCacheRules: true },\n    ).catch(() => ({}));\n    const json = resp.ok ? await resp.json() : { data: [] };\n    if (json.data.length === 0) { resolve({}); return; }\n    const placeholders = {};\n    json.data.forEach((item) => {\n      window.mph[item.key] = item.value;\n      placeholders[item.key] = item.value;\n    });\n    resolve(placeholders);\n  });\n  return fetchedPlaceholders[path];\n};\n\nfunction keyToStr(key) {\n  return key.replaceAll('-', ' ');\n}\n\nasync function getPlaceholder(key, config, sheet) {\n  let defaultFetched = false;\n  const defaultLocale = 'en-US';\n  const geoLocDisabled = getMetadata('disable-geo-placeholders') || 'off';\n\n  const getDefaultContentRoot = () => {\n    const defaultContentRoot = config.locale.contentRoot;\n    const localePrefix = config.locale.prefix;\n\n    if (!localePrefix.length) return defaultContentRoot;\n\n    // Certain locale prefixes are common beginnings of words, such as /es\n    // This could also be part of a page path, such as '/esign'\n    if (defaultContentRoot.endsWith(localePrefix)) {\n      return defaultContentRoot.replace(localePrefix, '');\n    }\n\n    return defaultContentRoot.replace(`${localePrefix}/`, '/');\n  };\n\n  const getDefaultPlaceholders = async () => {\n    const defaultConfig = {\n      locale: {\n        ietf: defaultLocale,\n        contentRoot: getDefaultContentRoot(),\n      },\n    };\n\n    const defaultPlaceholders = await fetchPlaceholders({ config: defaultConfig, sheet })\n      .catch(() => ({}));\n    defaultFetched = true;\n    return defaultPlaceholders;\n  };\n\n  if (config.placeholders?.[key]) return config.placeholders[key];\n  let placeholders;\n\n  if (geoLocDisabled === 'on') {\n    placeholders = await getDefaultPlaceholders();\n  } else {\n    placeholders = await fetchPlaceholders({ config, sheet });\n  }\n\n  if (typeof placeholders?.[key] === 'string') return placeholders[key];\n\n  if (!defaultFetched && config.locale.ietf !== defaultLocale) {\n    const defaultPlaceholders = await getDefaultPlaceholders();\n    if (defaultPlaceholders?.[key]) return defaultPlaceholders[key];\n  }\n\n  return keyToStr(key);\n}\n\nexport async function replaceKey(key, config, sheet = 'default') {\n  if (typeof key !== 'string' || !key.length) return '';\n\n  const label = await getPlaceholder(key, config, sheet);\n  return label;\n}\n\nexport async function replaceKeyArray(keys, config, sheet = 'default') {\n  if (!Array.isArray(keys) || !keys.length) return [];\n\n  const promiseArr = [];\n  keys.forEach((key) => {\n    promiseArr.push(getPlaceholder(key, config, sheet));\n  });\n\n  const placeholders = await Promise.all(promiseArr);\n  return placeholders;\n}\n\nexport async function replaceText(\n  text,\n  config,\n  regex = /{{(.*?)}}|%7B%7B(.*?)%7D%7D/g,\n  sheet = 'default',\n) {\n  if (typeof text !== 'string' || !text.length) return '';\n\n  const matches = [...text.matchAll(new RegExp(regex))];\n  if (!matches.length) {\n    return text;\n  }\n  const keys = Array.from(matches, (match) => match[1] || match[2]);\n  const placeholders = await replaceKeyArray(keys, config, sheet);\n  // The .shift method is very slow, thus using normal iterator\n  let i = 0;\n  // eslint-disable-next-line no-plusplus\n  let finalText = text.replaceAll(regex, () => placeholders[i++]);\n  finalText = finalText.replace(/&nbsp;/g, '\\u00A0');\n  return finalText;\n}\n\nexport async function decoratePlaceholderArea({\n  placeholderPath,\n  placeholderRequest,\n  nodes,\n}) {\n  if (!nodes.length) return;\n  const config = getConfig();\n  await fetchPlaceholders({ placeholderPath, config, placeholderRequest });\n  const replaceNodes = nodes.map(async (nodeEl) => {\n    if (nodeEl.nodeType === Node.TEXT_NODE) {\n      nodeEl.nodeValue = await replaceText(nodeEl.nodeValue, config);\n    } else if (nodeEl.nodeType === Node.ELEMENT_NODE) {\n      const attrPromises = [...nodeEl.attributes].map(async (attr) => {\n        const attrVal = await replaceText(attr.value, config);\n        return { name: attr.name, value: attrVal };\n      });\n      const results = await Promise.all(attrPromises);\n      results.forEach(({ name, value }) => {\n        nodeEl.setAttribute(name, value);\n      });\n    }\n  });\n  await Promise.all(replaceNodes);\n}\n","import { createTag, getConfig, reloadPage } from '../../utils/utils.js';\nimport { replaceKey } from '../../features/placeholders.js';\n\nconst MANAGE_PLAN_MSG_SUBTYPE = {\n  AppLoaded: 'AppLoaded',\n  EXTERNAL: 'EXTERNAL',\n  SWITCH: 'SWITCH',\n  RETURN_BACK: 'RETURN_BACK',\n  OrderComplete: 'OrderComplete',\n  Error: 'Error',\n  Close: 'Close',\n};\nconst isProductFamily = (offer, pfs) => {\n  const productFamily = offer?.offer?.product_arrangement?.family;\n  return productFamily && pfs.includes(productFamily);\n};\nexport const LANA_OPTIONS = {\n  clientId: 'merch-at-scale',\n  sampleRate: 10,\n  tags: 'manage-plan',\n};\n\nexport const lanaLog = async (msg, subType) => {\n  const { userId } = await window.adobeIMS?.getProfile() ?? {};\n  window.lana?.log(`ManagePlan/${subType}/${userId}: ${msg}`, LANA_OPTIONS);\n};\n\nlet shouldRefetchEntitlements = false;\n\nfunction buildUrl(upgradeOffer, upgradable, env) {\n  const toOffer = upgradeOffer?.value[0].offerId;\n  const fromOffer = upgradable?.offer?.offer_id;\n  if (!toOffer || !fromOffer) return undefined;\n  const url = new URL(env?.name === 'prod' ? 'https://plan.adobe.com' : 'https://stage.plan.adobe.com');\n  url.searchParams.append('intent', 'switch');\n  url.searchParams.append('toOfferId', toOffer);\n  url.searchParams.append('fromOffer', fromOffer);\n  url.searchParams.append('language', 'en'); // todo check where comes from\n  url.searchParams.append('surface', 'ADOBE_COM');\n  url.searchParams.append('ctx', 'if');\n  url.searchParams.append('ctxRtUrl', encodeURIComponent(window.location.href));\n  if (upgradeOffer.dataset?.promotionCode) {\n    url.searchParams.append('promoCode', upgradeOffer.dataset.promotionCode);\n  }\n  return url.toString();\n}\n\nexport const handleIFrameEvents = ({ data: msgData }) => {\n  let parsedMsg = null;\n  try {\n    parsedMsg = JSON.parse(msgData);\n  } catch (error) {\n    return;\n  }\n  const { app, subType, data } = parsedMsg || {};\n\n  if (app !== 'ManagePlan') return;\n  switch (subType) {\n    case MANAGE_PLAN_MSG_SUBTYPE.AppLoaded:\n      document.querySelector('.upgrade-flow-content iframe')?.classList?.remove('loading');\n      document.querySelector('.upgrade-flow-content sp-theme')?.remove();\n      lanaLog('Showing modal', subType);\n      break;\n    case MANAGE_PLAN_MSG_SUBTYPE.EXTERNAL:\n      if (!data?.externalUrl || !data.target) return;\n      lanaLog('Opening external URL', subType);\n      window.open(data.externalUrl, data.target);\n      break;\n    case MANAGE_PLAN_MSG_SUBTYPE.SWITCH:\n      if (!data?.externalUrl || !data.target) return;\n      lanaLog('Opening external URL (SWITCH)', subType);\n      window.open(data.externalUrl, data.target);\n      break;\n    case MANAGE_PLAN_MSG_SUBTYPE.RETURN_BACK:\n      if (!data?.externalUrl || !data.target) return;\n      if (data.returnUrl) {\n        window.sessionStorage.setItem('upgradeModalReturnUrl', data.returnUrl);\n      }\n      lanaLog('Opening external URL (RETURN_BACK)', subType);\n      window.open(data.externalUrl, data.target);\n      break;\n    case MANAGE_PLAN_MSG_SUBTYPE.OrderComplete:\n      shouldRefetchEntitlements = true;\n      break;\n    case MANAGE_PLAN_MSG_SUBTYPE.Error:\n      break;\n    case MANAGE_PLAN_MSG_SUBTYPE.Close:\n      if (shouldRefetchEntitlements) {\n        lanaLog('Reloading page to update entitlements', subType);\n        reloadPage();\n      }\n      lanaLog('Closing modal', subType);\n      document.querySelector('.dialog-modal.upgrade-flow-modal')?.dispatchEvent(new Event('closeModal'));\n      break;\n    default:\n      break;\n  }\n};\n\nexport default async function handleUpgradeOffer(\n  ctaPF,\n  upgradeOffer,\n  entitlements,\n  SOURCE_PF,\n  TARGET_PF,\n) {\n  if (!TARGET_PF.includes(ctaPF)) return undefined;\n\n  const hasUpgradeTarget = entitlements?.find((offer) => isProductFamily(offer, TARGET_PF));\n  if (hasUpgradeTarget) return undefined;\n\n  const changePlanOffers = entitlements?.filter((offer) => offer.change_plan_available === true);\n  const upgradable = changePlanOffers?.find((offer) => isProductFamily(offer, SOURCE_PF));\n  if (!upgradable) return undefined;\n\n  const { env, base } = getConfig();\n  const upgradeUrl = buildUrl(upgradeOffer, upgradable, env);\n  if (upgradeUrl) {\n    window.addEventListener('message', handleIFrameEvents);\n    const { getModal } = await import('../modal/modal.js');\n    const showModal = async (e, hash) => {\n      e.preventDefault();\n      await Promise.all([\n        import(`${base}/features/spectrum-web-components/dist/theme.js`),\n        import(`${base}/features/spectrum-web-components/dist/progress-circle.js`),\n      ]);\n      const content = createTag('div', { class: 'upgrade-flow-content' });\n      const iframe = createTag('iframe', {\n        src: upgradeUrl,\n        title: 'Upgrade modal',\n        frameborder: '0',\n        marginwidth: '0',\n        marginheight: '0',\n        allowfullscreen: 'true',\n        loading: 'lazy',\n        class: 'loading upgrade-flow-iframe',\n      });\n      const pCircle = createTag('sp-progress-circle', { label: 'progress circle', indeterminate: true, size: 'l' });\n      const theme = createTag('sp-theme', { theme: 'spectrum', color: 'light', scale: 'medium', dir: 'ltr' });\n      theme.append(pCircle);\n      content.append(theme);\n      content.append(iframe);\n      if (hash) {\n        const prevHash = window.location.hash.replace('#', '') === hash ? '' : window.location.hash;\n        window.location.hash = hash;\n        window.addEventListener('milo:modal:closed', () => {\n          window.location.hash = prevHash;\n        }, { once: true });\n      }\n      return getModal(null, { id: 'switch-modal', content, closeEvent: 'closeModal', class: ['upgrade-flow-modal'] });\n    };\n    const text = await replaceKey('upgrade-now', getConfig());\n    return { text, className: 'upgrade', url: upgradeUrl, handler: showModal };\n  }\n  return undefined;\n}\n"],"names":["webpackEmptyAsyncContext","req","Promise","resolve","then","e","Error","code","keys","id","module","exports","fetchedPlaceholders","window","mph","fetchPlaceholders","async","config","sheet","placeholderRequest","placeholderPath","_ref","path","getPlaceholdersPath","concat","locale","contentRoot","query","length","resp","customFetch","resource","withCacheRules","catch","json","ok","data","placeholders","forEach","item","key","value","getPlaceholder","_config$placeholders","_placeholders","defaultFetched","defaultLocale","geoLocDisabled","getMetadata","getDefaultContentRoot","defaultContentRoot","localePrefix","prefix","endsWith","replace","getDefaultPlaceholders","defaultConfig","ietf","defaultPlaceholders","replaceAll","keyToStr","replaceKey","arguments","undefined","replaceKeyArray","Array","isArray","promiseArr","push","all","replaceText","text","regex","matches","matchAll","RegExp","from","match","i","finalText","decoratePlaceholderArea","_ref2","nodes","getConfig","replaceNodes","map","nodeEl","nodeType","Node","TEXT_NODE","nodeValue","ELEMENT_NODE","attrPromises","attributes","attrVal","attr","name","_ref3","setAttribute","MANAGE_PLAN_MSG_SUBTYPE","isProductFamily","offer","pfs","_offer$offer","productFamily","product_arrangement","family","includes","LANA_OPTIONS","clientId","sampleRate","tags","lanaLog","msg","subType","_await$window$adobeIM","_window$adobeIMS","_window$lana","userId","adobeIMS","getProfile","lana","log","shouldRefetchEntitlements","handleIFrameEvents","_document$querySelect","_document$querySelect2","_document$querySelect3","msgData","parsedMsg","JSON","parse","error","app","document","querySelector","classList","remove","externalUrl","target","open","returnUrl","sessionStorage","setItem","reloadPage","dispatchEvent","Event","handleUpgradeOffer","ctaPF","upgradeOffer","entitlements","SOURCE_PF","TARGET_PF","find","changePlanOffers","filter","change_plan_available","upgradable","env","base","upgradeUrl","_upgradable$offer","_upgradeOffer$dataset","toOffer","offerId","fromOffer","offer_id","url","URL","searchParams","append","encodeURIComponent","location","href","dataset","promotionCode","toString","buildUrl","addEventListener","getModal","showModal","hash","preventDefault","content","createTag","class","iframe","src","title","frameborder","marginwidth","marginheight","allowfullscreen","loading","pCircle","label","indeterminate","size","theme","color","scale","dir","prevHash","once","closeEvent","className","handler"],"sourceRoot":""}