{"version":3,"file":"static/js/3283.da0228c7.chunk.js","mappings":"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","sources":["../node_modules/tools/utils/utils.js","../node_modules/@adobecom/tools/utils/publish.js","../node_modules/@adobecom/utils/sidekick-decorate.js"],"sourcesContent":["const IMS_CLIENT_ID = 'milo_ims';\nconst IMS_PROD_URL = 'https://auth.services.adobe.com/imslib/imslib.min.js';\nconst STYLE_SHEETS = {};\nconst CONFIGS = {};\n\nconst getImsToken = async (loadScript) => {\n  window.adobeid = {\n    client_id: IMS_CLIENT_ID,\n    environment: 'prod',\n    scope: 'AdobeID,openid',\n  };\n\n  if (!window.adobeIMS) {\n    await loadScript(IMS_PROD_URL);\n  }\n  return window.adobeIMS?.getAccessToken()?.token;\n};\n\nconst getSheet = async (url) => {\n  if (STYLE_SHEETS[url]) return STYLE_SHEETS[url];\n  const resp = await fetch(url);\n  const text = await resp.text();\n  const sheet = new CSSStyleSheet();\n  sheet.replace(text);\n  STYLE_SHEETS[url] = sheet;\n  return sheet;\n};\n\nconst getCustomConfig = async (path) => {\n  /* c8 ignore next 3 */\n  if (CONFIGS[path] !== undefined) {\n    return CONFIGS[path];\n  }\n  let config = null;\n  const resp = await fetch(path);\n  if (resp.ok) {\n    config = await resp.json();\n  }\n  CONFIGS[path] = config;\n  return CONFIGS[path];\n};\n\nexport { getImsToken, getSheet, getCustomConfig };\n","import { getCustomConfig } from '../../../tools/utils/utils.js';\n\nconst userCanPublishPage = async (detail, isBulk = true) => {\n  if (!detail) return false;\n  const { live, profile, webPath } = detail;\n  let canPublish = isBulk ? live?.permissions?.includes('write') : true;\n  let message = 'Publishing is currently disabled for this page';\n  const config = await getCustomConfig('/.milo/publish-permissions-config.json?limit=50000');\n  const item = config?.urls?.data?.find(({ url }) => (\n    url.endsWith('**') ? webPath.includes(url.slice(0, -2)) : url === webPath\n  ));\n  if (item) {\n    canPublish = false;\n    if (item.message) message = item.message;\n    const group = config[item.group];\n    if (group && profile?.email) {\n      let isDeny;\n      const user = group.data?.find(({ allow, deny }) => {\n        if (deny) {\n          /* c8 ignore next 3 */\n          isDeny = true;\n          return deny === profile.email;\n        }\n        return allow === profile.email;\n      });\n      canPublish = isDeny ? !user : !!user;\n    }\n  }\n  return { canPublish, message };\n};\n\nexport default userCanPublishPage;\n","import userCanPublishPage from '../tools/utils/publish.js';\n\nconst PUBLISH_BTN = '.publish.plugin button';\nconst PROFILE = '.profile-email';\nconst CONFIRM_MESSAGE = 'Are you sure? This will publish to production.';\nlet stylePublishCalled = false;\n\nfunction styleHelixPublish(sk) {\n  const setupPublishBtn = async (page, btn) => {\n    const { canPublish, message } = await userCanPublishPage(page, false);\n    if (canPublish) {\n      btn.removeAttribute('disabled');\n    } else {\n      btn.setAttribute('disabled', true);\n    }\n    const messageText = btn.querySelector('span');\n    const text = canPublish ? CONFIRM_MESSAGE : message;\n    if (messageText) {\n      messageText.innerText = text;\n    } else {\n      btn.insertAdjacentHTML('beforeend', `<span>${text}</span>`);\n    }\n  };\n\n  const style = new CSSStyleSheet();\n  style.replaceSync(`\n    :host {\n      --bg-color: rgb(129 27 14);\n      --text-color: #fff0f0;\n      color-scheme: light dark;\n    }\n    .publish.plugin {\n      order: 100;\n    }\n    .publish.plugin button {\n      position: relative;\n    }\n    .publish.plugin button:not([disabled=true]) {\n      background: var(--bg-color);\n      border-color: #b46157;\n      color: var(--text-color);\n    }\n    .publish.plugin button:not([disabled=true]):hover {\n      background-color: var(--hlx-sk-button-hover-bg);\n      border-color: unset;\n      color: var(--hlx-sk-button-hover-color);\n    }\n    .publish.plugin button > span {\n      display: none;\n      background: #666;\n      border-radius: 4px;\n      line-height: 1.2rem;\n      padding: 8px 12px;\n      position: absolute;\n      top: 34px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 150px;\n      white-space: pre-wrap;\n    }\n    .publish.plugin button:not([disabled=true]) > span {\n      background: var(--bg-color);\n    }\n    .publish.plugin button:hover > span {\n      display: block;\n      color: var(--text-color);\n    }\n    .publish.plugin button > span:before {\n      content: '';\n      border-left: 6px solid transparent;\n      border-right: 6px solid transparent;\n      border-bottom: 6px solid #666;\n      position: absolute;\n      text-align: center;\n      top: -6px;\n      left: 50%;\n      transform: translateX(-50%);\n    }\n    .publish.plugin button:not([disabled=true]) > span:before {\n      border-bottom: 6px solid var(--bg-color);\n    }\n  `);\n\n  sk.shadowRoot.adoptedStyleSheets = [style];\n\n  sk.addEventListener('statusfetched', async (event) => {\n    const page = event?.detail?.data;\n    const btn = event?.target?.shadowRoot?.querySelector(PUBLISH_BTN);\n    if (page && btn) {\n      setupPublishBtn(page, btn);\n    }\n  });\n\n  setTimeout(async () => {\n    const btn = sk.shadowRoot.querySelector(PUBLISH_BTN);\n    btn?.setAttribute('disabled', true);\n    const message = btn?.querySelector('span');\n    if (btn && !message) {\n      const page = {\n        webPath: window.location.pathname,\n        // added for edge case where the statusfetched event isnt fired on refresh\n        profile: { email: sk.shadowRoot.querySelector(PROFILE)?.innerText },\n      };\n      setupPublishBtn(page, btn);\n    }\n  }, 500);\n}\n\nasync function checkAuthorization(page, btn) {\n  const { canPublish, message } = await userCanPublishPage(page, false);\n  if (canPublish) {\n    btn.removeAttribute('disabled');\n    return;\n  }\n\n  btn.setAttribute('disabled', true);\n  btn.insertAdjacentHTML('beforeend', `<span>${message}</span>`);\n  setTimeout(() => btn.querySelector('span').remove(), 4000);\n}\n\nexport default async function stylePublish(sk) {\n  if (stylePublishCalled) return;\n  stylePublishCalled = true;\n\n  if (sk.nodeName === 'HELIX-SIDEKICK') {\n    styleHelixPublish(sk);\n    return;\n  }\n\n  const style = new CSSStyleSheet();\n  style.replaceSync(`\n    sk-action-button.publish {\n      position: relative;\n    }\n    sk-action-button.publish > span {\n      display: none;\n      background: #777;\n      border-radius: 4px;\n      line-height: 1.2rem;\n      padding: 8px 12px;\n      position: absolute;\n      bottom: 34px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 150px;\n      white-space: pre-wrap;\n      color: black;\n    }\n    sk-action-button.publish[disabled] > span {\n      display: block;\n    }\n    sk-action-button.publish > span:before {\n      content: '';\n      border-left: 6px solid transparent;\n      border-right: 6px solid transparent;\n      border-top: 6px solid #777;\n      position: absolute;\n      text-align: center;\n      bottom: -6px;\n      left: 50%;\n      transform: translateX(-50%);\n    }\n  `);\n\n  const pluginActionBarSR = sk.shadowRoot.querySelector('plugin-action-bar').shadowRoot;\n  pluginActionBarSR.adoptedStyleSheets ??= [];\n  pluginActionBarSR.adoptedStyleSheets.push(style);\n\n  const publishBtn = pluginActionBarSR.querySelector('sk-action-button.publish');\n  if (!publishBtn) {\n    sk.addEventListener('status-fetched', ({ target, detail }) => {\n      setTimeout(async () => {\n        const btn = target.shadowRoot.querySelector('plugin-action-bar').shadowRoot.querySelector('sk-action-button.publish');\n        if (detail && btn) await checkAuthorization(detail, btn);\n      }, 0);\n    });\n  }\n\n  const pageDetail = {\n    webPath: window.location.pathname,\n    profile: { email: pluginActionBarSR.querySelector('#user')?.shadowRoot.querySelector('.user [slot=\"description\"]')?.innerText },\n  };\n  if (pageDetail && publishBtn) await checkAuthorization(pageDetail, publishBtn);\n}\n"],"names":["c","p","async","e","_n$permissions","_r$urls","o","arguments","length","undefined","live","n","profile","t","webPath","s","i","permissions","includes","a","r","fetch","ok","json","f","l","urls","data","find","_ref","url","u","endsWith","slice","message","group","email","_u$data","d","b","_ref2","allow","w","deny","h","canPublish","g","x","v","m","S","removeAttribute","setAttribute","insertAdjacentHTML","concat","setTimeout","querySelector","remove","k","_n$adoptedStyleSheets","_n$querySelector","nodeName","innerText","CSSStyleSheet","replaceSync","shadowRoot","adoptedStyleSheets","addEventListener","_t$detail","_t$target","detail","target","_e$shadowRoot$querySe","window","location","pathname","P","push","_ref3"],"sourceRoot":""}