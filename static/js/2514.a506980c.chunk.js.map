{"version":3,"file":"static/js/2514.a506980c.chunk.js","mappings":"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","sources":["../../milo/libs/blocks/global-navigation/utilities/getUserEntitlements.js"],"sourcesContent":["/* eslint import/no-relative-packages: 0 */\n/* eslint-disable camelcase */\nimport { getConfig } from '../../../utils/utils.js';\n\nconst API_WAIT_TIMEOUT = 10000;\nconst FORMAT_RAW = 'raw';\nlet entitlements = {};\n\nconst getAcceptLanguage = (locale = 'en-US') => [\n  `${locale}`,\n  `${locale.split('-')[0]};q=0.9`,\n  'en;q=0.8',\n].join(',');\n\nconst getQueryParameters = (params) => {\n  const query = [];\n  if (Array.isArray(params) && params.length) {\n    params.forEach((parameter = {}) => {\n      const { name, value } = parameter;\n      if (typeof name === 'string' && name.length) {\n        query.push(`${encodeURIComponent(name)}=${encodeURIComponent(value)}`);\n      }\n    });\n  }\n\n  return query.length ? `?${query.join('&')}` : '';\n};\n\nconst emptyEntitlements = (format) => (format === FORMAT_RAW ? [] : ({\n  clouds: {},\n  arrangement_codes: {},\n  fulfilled_codes: {},\n  offer_families: {},\n  offers: {},\n  list: { fulfilled_codes: [] },\n}));\nconst CREATIVE_CLOUD = 'creative_cloud';\nconst DOCUMENT_CLOUD = 'document_cloud';\nconst EXPERIENCE_CLOUD = 'experience_cloud';\n\n/**\n * Breaks JIL offers(subscriptions) into easily addressable flat data structure.\n * @param {*} allOffers\n */\nconst mapSubscriptionCodes = (allOffers) => {\n  if (!Array.isArray(allOffers)) {\n    return emptyEntitlements();\n  }\n\n  const {\n    clouds,\n    arrangement_codes,\n    fulfilled_codes,\n    offer_families,\n    offers,\n    list,\n  } = emptyEntitlements();\n\n  allOffers.forEach(({ fulfilled_items, offer = {} }) => {\n    const cloud = offer.product_arrangement?.cloud;\n    clouds[CREATIVE_CLOUD] = clouds[CREATIVE_CLOUD] || cloud === 'CREATIVE';\n    clouds[DOCUMENT_CLOUD] = clouds[DOCUMENT_CLOUD] || cloud === 'DOCUMENT';\n    clouds[EXPERIENCE_CLOUD] = clouds[EXPERIENCE_CLOUD] || cloud === 'EXPERIENCE';\n\n    const family = offer.product_arrangement?.family;\n    if (family) {\n      offer_families[family.toLowerCase()] = true;\n    }\n\n    if (offer.product_arrangement_code) {\n      arrangement_codes[offer.product_arrangement_code] = true;\n    }\n\n    if (Array.isArray(fulfilled_items)) {\n      fulfilled_items.forEach(({ code }) => {\n        if (code && list.fulfilled_codes.indexOf(code) === -1) {\n          fulfilled_codes[code] = true;\n          list.fulfilled_codes.push(code);\n        }\n      });\n    }\n\n    if (offer.offer_id) {\n      const { offer_id, ...rest } = offer;\n      offers[offer_id] = rest;\n    }\n  });\n\n  return {\n    clouds,\n    arrangement_codes,\n    fulfilled_codes,\n    offer_families,\n    offers,\n    list,\n  };\n};\n\nconst getSubscriptions = async ({ queryParams }, format) => {\n  const config = getConfig();\n  const profile = await window.adobeIMS.getProfile();\n  const apiUrl = config.env.name === 'prod'\n    ? `https://www.adobe.com/aos-api/users/${profile.userId}/subscriptions`\n    : `https://www.stage.adobe.com/aos-api/users/${profile.userId}/subscriptions`;\n  const res = await fetch(`${apiUrl}${queryParams}`, {\n    method: 'GET',\n    cache: 'no-cache',\n    credentials: 'same-origin',\n    // TODO: refactor to not use AbortSignal.timeout() as it's not supported for Safari 14\n    /* eslint-disable-next-line */\n    signal: AbortSignal.timeout(API_WAIT_TIMEOUT),\n    headers: {\n      Authorization: `Bearer ${window.adobeIMS.getAccessToken().token}`,\n      'X-Api-Key': window.adobeIMS.adobeIdData.client_id,\n      'Accept-Language': getAcceptLanguage(config.locale.ietf),\n    },\n  })\n    .then((response) => (response.status === 200 ? response.json() : emptyEntitlements(format)));\n  return res;\n};\n\n/**\n * @description Return the JIL User Entitlements\n * @param {object} object required params\n * @param {array} object.params array of name value query parameters [{name: 'Q', value: 'PARAM'}]\n * @param {string} object.format format function, raw or default\n * @returns {object} JIL Entitlements\n */\nconst getUserEntitlements = async ({ params, format } = {}) => {\n  if (!window.adobeIMS?.isSignedInUser()) {\n    entitlements = {};\n    return Promise.resolve(emptyEntitlements(format));\n  }\n\n  const queryParams = getQueryParameters(params);\n  if (entitlements[queryParams]) {\n    return format === FORMAT_RAW\n      ? entitlements[queryParams]\n      : entitlements[queryParams]\n        .then((res) => mapSubscriptionCodes(res))\n        .catch(() => emptyEntitlements(format));\n  }\n\n  entitlements[queryParams] = entitlements[queryParams]\n   || new Promise((resolve) => {\n     getSubscriptions({ queryParams }, format)\n       .then((data) => resolve(data))\n       .catch(() => resolve(emptyEntitlements(format)));\n   });\n\n  return format === FORMAT_RAW\n    ? entitlements[queryParams]\n    : entitlements[queryParams]\n      .then((res) => mapSubscriptionCodes(res))\n      .catch(() => emptyEntitlements(format));\n};\n\nexport default getUserEntitlements;\n"],"names":["f","r","y","o","arguments","length","undefined","concat","split","join","c","clouds","arrangement_codes","fulfilled_codes","offer_families","offers","list","h","m","E","w","Array","isArray","e","t","n","s","u","i","forEach","_ref","_a$product_arrangemen","_a$product_arrangemen2","fulfilled_items","g","offer","a","l","product_arrangement","cloud","p","family","toLowerCase","product_arrangement_code","_ref2","code","d","indexOf","push","offer_id","A","$","async","_window$adobeIMS","params","format","window","adobeIMS","isSignedInUser","Promise","resolve","name","value","encodeURIComponent","C","_ref3","queryParams","_","getProfile","env","userId","fetch","method","cache","credentials","signal","AbortSignal","timeout","headers","Authorization","getAccessToken","token","adobeIdData","client_id","locale","ietf","then","status","json","b","catch"],"sourceRoot":""}