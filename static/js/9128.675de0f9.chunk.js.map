{"version":3,"file":"static/js/9128.675de0f9.chunk.js","mappings":"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","sources":["../node_modules/@adobecom/utils/action.js","../node_modules/tools/utils/utils.js","../node_modules/@adobecom/tools/utils/publish.js","../node_modules/@adobecom/utils/sidekick-decorate.js","../node_modules/@adobecom/utils/sidekick.js"],"sourcesContent":["export function debounce(callback, time = 300) {\n  if (typeof callback !== 'function') return undefined;\n\n  let timer = null;\n\n  return (...args) => {\n    clearTimeout(timer);\n    timer = setTimeout(() => callback(...args), time);\n  };\n}\n\nexport default { debounce };\n","const IMS_CLIENT_ID = 'milo_ims';\nconst IMS_PROD_URL = 'https://auth.services.adobe.com/imslib/imslib.min.js';\nconst STYLE_SHEETS = {};\nconst CONFIGS = {};\n\nconst getImsToken = async (loadScript) => {\n  window.adobeid = {\n    client_id: IMS_CLIENT_ID,\n    environment: 'prod',\n    scope: 'AdobeID,openid',\n  };\n\n  if (!window.adobeIMS) {\n    await loadScript(IMS_PROD_URL);\n  }\n  return window.adobeIMS?.getAccessToken()?.token;\n};\n\nconst getSheet = async (url) => {\n  if (STYLE_SHEETS[url]) return STYLE_SHEETS[url];\n  const resp = await fetch(url);\n  const text = await resp.text();\n  const sheet = new CSSStyleSheet();\n  sheet.replace(text);\n  STYLE_SHEETS[url] = sheet;\n  return sheet;\n};\n\nconst getCustomConfig = async (path) => {\n  /* c8 ignore next 3 */\n  if (CONFIGS[path] !== undefined) {\n    return CONFIGS[path];\n  }\n  let config = null;\n  const resp = await fetch(path);\n  if (resp.ok) {\n    config = await resp.json();\n  }\n  CONFIGS[path] = config;\n  return CONFIGS[path];\n};\n\nexport { getImsToken, getSheet, getCustomConfig };\n","import { getCustomConfig } from '../../../tools/utils/utils.js';\n\nconst userCanPublishPage = async (detail, isBulk = true) => {\n  if (!detail) return false;\n  const { live, profile, webPath } = detail;\n  let canPublish = isBulk ? live?.permissions?.includes('write') : true;\n  let message = 'Publishing is currently disabled for this page';\n  const config = await getCustomConfig('/.milo/publish-permissions-config.json?limit=50000');\n  const item = config?.urls?.data?.find(({ url }) => (\n    url.endsWith('**') ? webPath.includes(url.slice(0, -2)) : url === webPath\n  ));\n  if (item) {\n    canPublish = false;\n    if (item.message) message = item.message;\n    const group = config[item.group];\n    if (group && profile?.email) {\n      let isDeny;\n      const user = group.data?.find(({ allow, deny }) => {\n        if (deny) {\n          /* c8 ignore next 3 */\n          isDeny = true;\n          return deny === profile.email;\n        }\n        return allow === profile.email;\n      });\n      canPublish = isDeny ? !user : !!user;\n    }\n  }\n  return { canPublish, message };\n};\n\nexport default userCanPublishPage;\n","import userCanPublishPage from '../tools/utils/publish.js';\n\nconst PUBLISH_BTN = '.publish.plugin button';\nconst PROFILE = '.profile-email';\nconst CONFIRM_MESSAGE = 'Are you sure? This will publish to production.';\nlet stylePublishCalled = false;\n\nfunction styleHelixPublish(sk) {\n  const setupPublishBtn = async (page, btn) => {\n    const { canPublish, message } = await userCanPublishPage(page, false);\n    if (canPublish) {\n      btn.removeAttribute('disabled');\n    } else {\n      btn.setAttribute('disabled', true);\n    }\n    const messageText = btn.querySelector('span');\n    const text = canPublish ? CONFIRM_MESSAGE : message;\n    if (messageText) {\n      messageText.innerText = text;\n    } else {\n      btn.insertAdjacentHTML('beforeend', `<span>${text}</span>`);\n    }\n  };\n\n  const style = new CSSStyleSheet();\n  style.replaceSync(`\n    :host {\n      --bg-color: rgb(129 27 14);\n      --text-color: #fff0f0;\n      color-scheme: light dark;\n    }\n    .publish.plugin {\n      order: 100;\n    }\n    .publish.plugin button {\n      position: relative;\n    }\n    .publish.plugin button:not([disabled=true]) {\n      background: var(--bg-color);\n      border-color: #b46157;\n      color: var(--text-color);\n    }\n    .publish.plugin button:not([disabled=true]):hover {\n      background-color: var(--hlx-sk-button-hover-bg);\n      border-color: unset;\n      color: var(--hlx-sk-button-hover-color);\n    }\n    .publish.plugin button > span {\n      display: none;\n      background: #666;\n      border-radius: 4px;\n      line-height: 1.2rem;\n      padding: 8px 12px;\n      position: absolute;\n      top: 34px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 150px;\n      white-space: pre-wrap;\n    }\n    .publish.plugin button:not([disabled=true]) > span {\n      background: var(--bg-color);\n    }\n    .publish.plugin button:hover > span {\n      display: block;\n      color: var(--text-color);\n    }\n    .publish.plugin button > span:before {\n      content: '';\n      border-left: 6px solid transparent;\n      border-right: 6px solid transparent;\n      border-bottom: 6px solid #666;\n      position: absolute;\n      text-align: center;\n      top: -6px;\n      left: 50%;\n      transform: translateX(-50%);\n    }\n    .publish.plugin button:not([disabled=true]) > span:before {\n      border-bottom: 6px solid var(--bg-color);\n    }\n  `);\n\n  sk.shadowRoot.adoptedStyleSheets = [style];\n\n  sk.addEventListener('statusfetched', async (event) => {\n    const page = event?.detail?.data;\n    const btn = event?.target?.shadowRoot?.querySelector(PUBLISH_BTN);\n    if (page && btn) {\n      setupPublishBtn(page, btn);\n    }\n  });\n\n  setTimeout(async () => {\n    const btn = sk.shadowRoot.querySelector(PUBLISH_BTN);\n    btn?.setAttribute('disabled', true);\n    const message = btn?.querySelector('span');\n    if (btn && !message) {\n      const page = {\n        webPath: window.location.pathname,\n        // added for edge case where the statusfetched event isnt fired on refresh\n        profile: { email: sk.shadowRoot.querySelector(PROFILE)?.innerText },\n      };\n      setupPublishBtn(page, btn);\n    }\n  }, 500);\n}\n\nasync function checkAuthorization(page, btn) {\n  const { canPublish, message } = await userCanPublishPage(page, false);\n  if (canPublish) {\n    btn.removeAttribute('disabled');\n    return;\n  }\n\n  btn.setAttribute('disabled', true);\n  btn.insertAdjacentHTML('beforeend', `<span>${message}</span>`);\n  setTimeout(() => btn.querySelector('span').remove(), 4000);\n}\n\nexport default async function stylePublish(sk) {\n  if (stylePublishCalled) return;\n  stylePublishCalled = true;\n\n  if (sk.nodeName === 'HELIX-SIDEKICK') {\n    styleHelixPublish(sk);\n    return;\n  }\n\n  const style = new CSSStyleSheet();\n  style.replaceSync(`\n    sk-action-button.publish {\n      position: relative;\n    }\n    sk-action-button.publish > span {\n      display: none;\n      background: #777;\n      border-radius: 4px;\n      line-height: 1.2rem;\n      padding: 8px 12px;\n      position: absolute;\n      bottom: 34px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 150px;\n      white-space: pre-wrap;\n      color: black;\n    }\n    sk-action-button.publish[disabled] > span {\n      display: block;\n    }\n    sk-action-button.publish > span:before {\n      content: '';\n      border-left: 6px solid transparent;\n      border-right: 6px solid transparent;\n      border-top: 6px solid #777;\n      position: absolute;\n      text-align: center;\n      bottom: -6px;\n      left: 50%;\n      transform: translateX(-50%);\n    }\n  `);\n\n  const pluginActionBarSR = sk.shadowRoot.querySelector('plugin-action-bar').shadowRoot;\n  pluginActionBarSR.adoptedStyleSheets ??= [];\n  pluginActionBarSR.adoptedStyleSheets.push(style);\n\n  const publishBtn = pluginActionBarSR.querySelector('sk-action-button.publish');\n  if (!publishBtn) {\n    sk.addEventListener('status-fetched', ({ target, detail }) => {\n      setTimeout(async () => {\n        const btn = target.shadowRoot.querySelector('plugin-action-bar').shadowRoot.querySelector('sk-action-button.publish');\n        if (detail && btn) await checkAuthorization(detail, btn);\n      }, 0);\n    });\n  }\n\n  const pageDetail = {\n    webPath: window.location.pathname,\n    profile: { email: pluginActionBarSR.querySelector('#user')?.shadowRoot.querySelector('.user [slot=\"description\"]')?.innerText },\n  };\n  if (pageDetail && publishBtn) await checkAuthorization(pageDetail, publishBtn);\n}\n","import stylePublish from './sidekick-decorate.js';\nimport { debounce } from './action.js';\n\n// loadScript and loadStyle are passed in to avoid circular dependencies\nexport default function init({ createTag, loadBlock, loadScript, loadStyle }) {\n  const sendToCaasListener = async (e) => {\n    // handle v2 and v3 sidekick events\n    const config = e.detail.data?.config ?? e.detail.config;\n    const { host, project, ref: branch, repo, owner } = config;\n    // eslint-disable-next-line import/no-unresolved\n    const { sendToCaaS } = await import('https://milo.adobe.com/tools/send-to-caas/send-to-caas.js');\n    sendToCaaS({ host, project, branch, repo, owner }, loadScript, loadStyle);\n  };\n\n  const checkSchemaListener = async () => {\n    const schema = document.querySelector('script[type=\"application/ld+json\"]');\n    if (schema === null) return;\n    const resultsUrl = 'https://search.google.com/test/rich-results?url=';\n    window.open(`${resultsUrl}${encodeURIComponent(window.location.href)}`, 'check-schema');\n  };\n\n  const preflightListener = async () => {\n    const preflight = createTag('div', { class: 'preflight' });\n    const content = await loadBlock(preflight);\n\n    const { getModal } = await import('../blocks/modal/modal.js');\n    getModal(null, { id: 'preflight', content, closeEvent: 'closeModal' });\n  };\n\n  const sk = document.querySelector('aem-sidekick, helix-sidekick');\n\n  // Add plugin listeners here\n  sk.addEventListener('custom:send-to-caas', debounce(sendToCaasListener, 500));\n  sk.addEventListener('custom:check-schema', checkSchemaListener);\n  sk.addEventListener('custom:preflight', debounce(() => preflightListener(), 500));\n\n  // Color code publish button\n  stylePublish(sk);\n}\n"],"names":["debounce","callback","time","arguments","length","undefined","timer","_len","args","Array","_key","clearTimeout","setTimeout","action_default","CONFIGS","publish_default","async","detail","_live$permissions","_config$urls","isBulk","live","profile","webPath","canPublish","permissions","includes","message","config","path","resp","fetch","ok","json","getCustomConfig","item","urls","data","find","_ref","url","endsWith","slice","group","email","_group$data","isDeny","user","_ref2","allow","deny","PUBLISH_BTN","PROFILE","CONFIRM_MESSAGE","stylePublishCalled","checkAuthorization","page","btn","removeAttribute","setAttribute","insertAdjacentHTML","concat","querySelector","remove","stylePublish","sk","_pluginActionBarSR$ad","_pluginActionBarSR$qu","nodeName","setupPublishBtn","messageText","text","innerText","style","CSSStyleSheet","replaceSync","shadowRoot","adoptedStyleSheets","addEventListener","_event$detail","_event$target","event","target","_sk$shadowRoot$queryS","window","location","pathname","styleHelixPublish","pluginActionBarSR","push","publishBtn","_ref3","pageDetail","init","createTag","loadBlock","loadScript","loadStyle","document","_e$detail$data$config","_e$detail$data","e","host","project","ref","branch","repo","owner","sendToCaaS","open","encodeURIComponent","href","preflight","class","content","getModal","id","closeEvent","preflightListener"],"sourceRoot":""}