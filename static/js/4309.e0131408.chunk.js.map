{"version":3,"file":"static/js/4309.e0131408.chunk.js","mappings":"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","sources":["../node_modules/@adobecom/blocks/global-navigation/utilities/getUserEntitlements.js"],"sourcesContent":["/* eslint import/no-relative-packages: 0 */\n/* eslint-disable camelcase */\nimport { getConfig } from '../../../utils/utils.js';\n\nconst API_WAIT_TIMEOUT = 10000;\nconst FORMAT_RAW = 'raw';\nlet entitlements = {};\n\nconst getAcceptLanguage = (locale = 'en-US') => [\n  `${locale}`,\n  `${locale.split('-')[0]};q=0.9`,\n  'en;q=0.8',\n].join(',');\n\nconst getQueryParameters = (params) => {\n  const query = [];\n  if (Array.isArray(params) && params.length) {\n    params.forEach((parameter = {}) => {\n      const { name, value } = parameter;\n      if (typeof name === 'string' && name.length) {\n        query.push(`${encodeURIComponent(name)}=${encodeURIComponent(value)}`);\n      }\n    });\n  }\n\n  return query.length ? `?${query.join('&')}` : '';\n};\n\nconst emptyEntitlements = (format) => (format === FORMAT_RAW ? [] : ({\n  clouds: {},\n  arrangement_codes: {},\n  fulfilled_codes: {},\n  offer_families: {},\n  offers: {},\n  list: { fulfilled_codes: [] },\n}));\nconst CREATIVE_CLOUD = 'creative_cloud';\nconst DOCUMENT_CLOUD = 'document_cloud';\nconst EXPERIENCE_CLOUD = 'experience_cloud';\n\n/**\n * Breaks JIL offers(subscriptions) into easily addressable flat data structure.\n * @param {*} allOffers\n */\nconst mapSubscriptionCodes = (allOffers) => {\n  if (!Array.isArray(allOffers)) {\n    return emptyEntitlements();\n  }\n\n  const {\n    clouds,\n    arrangement_codes,\n    fulfilled_codes,\n    offer_families,\n    offers,\n    list,\n  } = emptyEntitlements();\n\n  allOffers.forEach(({ fulfilled_items, offer = {} }) => {\n    const cloud = offer.product_arrangement?.cloud;\n    clouds[CREATIVE_CLOUD] = clouds[CREATIVE_CLOUD] || cloud === 'CREATIVE';\n    clouds[DOCUMENT_CLOUD] = clouds[DOCUMENT_CLOUD] || cloud === 'DOCUMENT';\n    clouds[EXPERIENCE_CLOUD] = clouds[EXPERIENCE_CLOUD] || cloud === 'EXPERIENCE';\n\n    const family = offer.product_arrangement?.family;\n    if (family) {\n      offer_families[family.toLowerCase()] = true;\n    }\n\n    if (offer.product_arrangement_code) {\n      arrangement_codes[offer.product_arrangement_code] = true;\n    }\n\n    if (Array.isArray(fulfilled_items)) {\n      fulfilled_items.forEach(({ code }) => {\n        if (code && list.fulfilled_codes.indexOf(code) === -1) {\n          fulfilled_codes[code] = true;\n          list.fulfilled_codes.push(code);\n        }\n      });\n    }\n\n    if (offer.offer_id) {\n      const { offer_id, ...rest } = offer;\n      offers[offer_id] = rest;\n    }\n  });\n\n  return {\n    clouds,\n    arrangement_codes,\n    fulfilled_codes,\n    offer_families,\n    offers,\n    list,\n  };\n};\n\nconst getSubscriptions = async ({ queryParams }, format) => {\n  const config = getConfig();\n  const profile = await window.adobeIMS.getProfile();\n  const apiUrl = config.env.name === 'prod'\n    ? `https://www.adobe.com/aos-api/users/${profile.userId}/subscriptions`\n    : `https://www.stage.adobe.com/aos-api/users/${profile.userId}/subscriptions`;\n  const res = await fetch(`${apiUrl}${queryParams}`, {\n    method: 'GET',\n    cache: 'no-cache',\n    credentials: 'same-origin',\n    // TODO: refactor to not use AbortSignal.timeout() as it's not supported for Safari 14\n    /* eslint-disable-next-line */\n    signal: AbortSignal.timeout(API_WAIT_TIMEOUT),\n    headers: {\n      Authorization: `Bearer ${window.adobeIMS.getAccessToken().token}`,\n      'X-Api-Key': window.adobeIMS.adobeIdData.client_id,\n      'Accept-Language': getAcceptLanguage(config.locale.ietf),\n    },\n  })\n    .then((response) => (response.status === 200 ? response.json() : emptyEntitlements(format)));\n  return res;\n};\n\n/**\n * @description Return the JIL User Entitlements\n * @param {object} object required params\n * @param {array} object.params array of name value query parameters [{name: 'Q', value: 'PARAM'}]\n * @param {string} object.format format function, raw or default\n * @returns {object} JIL Entitlements\n */\nconst getUserEntitlements = async ({ params, format } = {}) => {\n  if (!window.adobeIMS?.isSignedInUser()) {\n    entitlements = {};\n    return Promise.resolve(emptyEntitlements(format));\n  }\n\n  const queryParams = getQueryParameters(params);\n  if (entitlements[queryParams]) {\n    return format === FORMAT_RAW\n      ? entitlements[queryParams]\n      : entitlements[queryParams]\n        .then((res) => mapSubscriptionCodes(res))\n        .catch(() => emptyEntitlements(format));\n  }\n\n  entitlements[queryParams] = entitlements[queryParams]\n   || new Promise((resolve) => {\n     getSubscriptions({ queryParams }, format)\n       .then((data) => resolve(data))\n       .catch(() => resolve(emptyEntitlements(format)));\n   });\n\n  return format === FORMAT_RAW\n    ? entitlements[queryParams]\n    : entitlements[queryParams]\n      .then((res) => mapSubscriptionCodes(res))\n      .catch(() => emptyEntitlements(format));\n};\n\nexport default getUserEntitlements;\n"],"names":["FORMAT_RAW","entitlements","getAcceptLanguage","locale","arguments","length","undefined","concat","split","join","emptyEntitlements","format","clouds","arrangement_codes","fulfilled_codes","offer_families","offers","list","CREATIVE_CLOUD","DOCUMENT_CLOUD","EXPERIENCE_CLOUD","mapSubscriptionCodes","allOffers","Array","isArray","forEach","_ref","_offer$product_arrang","_offer$product_arrang2","fulfilled_items","offer","cloud","product_arrangement","family","toLowerCase","product_arrangement_code","_ref2","code","indexOf","push","offer_id","rest","getUserEntitlements_default","async","_window$adobeIMS","params","window","adobeIMS","isSignedInUser","Promise","resolve","queryParams","query","parameter","name","value","encodeURIComponent","getQueryParameters","_ref3","config","getConfig","profile","getProfile","apiUrl","env","userId","fetch","method","cache","credentials","signal","AbortSignal","timeout","headers","Authorization","getAccessToken","token","adobeIdData","client_id","ietf","then","response","status","json","getSubscriptions","data","catch","res"],"sourceRoot":""}