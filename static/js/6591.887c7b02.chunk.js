"use strict";(self.webpackChunknav_consumer=self.webpackChunknav_consumer||[]).push([[6591],{8972:(t,e,i)=>{i.r(e),i.d(e,{AppPrompt:()=>y,DISMISSAL_CONFIG:()=>u,default:()=>w});var o,s,n,a,r,l,c=i(4705),d=i(7528),p=i(2342),h=(i(3458),i(3815)),m=i(5379),u=(i(2560),{animationCount:2,animationDuration:2500,tooltipMessage:"Use the App Switcher to quickly find apps.",tooltipDuration:5e3}),v={selectors:{prompt:".appPrompt"},delay:7e3,loaderColor:"#EB1000",pauseOnHover:"off",...u},f=t=>{var e;return null===t||void 0===t||null===(e=t.textContent)||void 0===e?void 0:e.trim()},g=()=>!!document.querySelector(".dialog-modal"),P=t=>{g()?setTimeout((()=>P(t)),200):t()},y=(s=class t{constructor(){var e=this;let{promptPath:i,entName:s,parent:u,getAnchorState:y}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,c.A)(this,"init",(async()=>{if(this.isDismissedPrompt()||!this.parent||!new URLSearchParams(window.location.search).get("skipPepEntitlements")&&!await this.doesEntitlementMatch())return;let t=await this.fetchContent();t&&(await this.getData(t),this.options["redirect-url"]&&this.options["product-name"]&&(({id:this.anchorId,isOpen:this.isAnchorExpanded}=await this.getAnchorState().catch((t=>((0,p.d)({message:"Error on getting anchor state",e:t,tags:"pep",errorType:"e"}),{})))),!this.isAnchorExpanded&&(this.anchorId&&(this.anchor=document.querySelector("#".concat(this.anchorId))),this.offset=this.anchor?this.parent.offsetWidth-(this.anchor.offsetWidth+this.anchor.offsetLeft):0,this.template=this.decorate(),this.addEventListeners(),this.parent.prepend(this.template),this.elements.closeIcon.focus(),this.cleanupFn=this.initRedirect("on"===this.options["pause-on-hover"]))))})),(0,c.A)(this,"doesEntitlementMatch",(async()=>{var t;let e=await(0,m.i)().entitlements();return null!==(t=new URLSearchParams(window.location.search).get("mockPepEnts"))&&void 0!==t&&t.split(",").forEach((t=>e.push(t.trim()))),(null===e||void 0===e?void 0:e.length)&&e.includes(this.entName)})),(0,c.A)(this,"fetchContent",(async()=>{let t=await fetch("".concat(this.promptPath,".plain.html"));if(!t.ok)return(0,p.d)({message:"Error fetching content for prompt: ".concat(this.promptPath,".plain.html"),e:"Status ".concat(t.status," when trying to fetch content for prompt"),tags:"pep",errorType:"e"}),"";let e=await t.text(),i=await(0,h.c)(e,(0,m.n)());return(new DOMParser).parseFromString(i,"text/html")})),(0,c.A)(this,"getData",(async t=>{var e,i,o,s,n;this.icon=(t=>{let e=t.querySelector("picture");if(e)return e;let i=t.querySelector('a[href$=".svg"]');return i?(0,m.B)(i):p.b.company})(t);let a={title:"h2",subtitle:"h3",cancel:"em > a"};await Promise.all(Object.keys(a).map((async e=>{let i=t.querySelector(a[e]);if(null!==i&&void 0!==i&&i.innerText)this[e]=i.innerText;else{let t=await(0,h.a)("pep-prompt-".concat(e),(0,m.n)());this[e]=t==="pep prompt ".concat(e)?"":t}}))),await(0,p.M)().then((t=>{["display_name","email","avatar"].every((e=>!!t[e]))&&(this.profile=t)})).catch((t=>{(0,p.d)({message:"Error fetching user profile",e:t,tags:"pep",errorType:"e"})}));let r=(t=>[...t.childNodes].reduce(((t,e)=>{var i;if(2===(null===(i=e.children)||void 0===i?void 0:i.length)){let i=f(e.children[0]),o=f(e.children[1]);i&&o&&(t[i]=o)}return t}),{}))(t.querySelector(".section-metadata"));r["loader-duration"]=parseInt(r["loader-duration"]||v.delay,10),r["loader-color"]=r["loader-color"]||v.loaderColor,r["dismissal-animation-count"]=parseInt(null!==(e=r["dismissal-animation-count"])&&void 0!==e?e:v.animationCount,10),r["dismissal-animation-duration"]=parseInt(null!==(i=r["dismissal-animation-duration"])&&void 0!==i?i:v.animationDuration,10),null!==(o=r["dismissal-tooltip-message"])&&void 0!==o||(r["dismissal-tooltip-message"]=v.tooltipMessage),r["dismissal-tooltip-duration"]=parseInt(null!==(s=r["dismissal-tooltip-duration"])&&void 0!==s?s:v.tooltipDuration,10),null!==(n=r["pause-on-hover"])&&void 0!==n||(r["pause-on-hover"]=v.pauseOnHover),this.options=r})),(0,c.A)(this,"decorate",(()=>{var t;let e="on"===this.options["pause-on-hover"];return this.elements.closeIcon=(0,p.h)(n||(n=(0,d.A)(['<button daa-ll="Close Modal" aria-label="','" class="appPrompt-close"></button>'])),this.cancel),this.elements.cta=(0,p.h)(a||(a=(0,d.A)(['<button daa-ll="Stay on this page" class="appPrompt-cta appPrompt-cta--close">',"</button>"])),this.cancel),this.elements.profile=this.profile?(0,p.h)(r||(r=(0,d.A)(['<div class="appPrompt-profile">\n        <div class="appPrompt-avatar">\n          <img class="appPrompt-avatar-image" src="','" />\n        </div>\n        <div class="appPrompt-user">\n          <div class="appPrompt-name">','</div>\n          <div class="appPrompt-email">',"</div>\n        </div>\n      </div>"])),this.profile.avatar,this.profile.display_name,this.profile.email):"",(0,p.h)(l||(l=(0,d.A)(['<div\n      daa-state="true" daa-im="true" daa-lh="PEP Modal_','"\n      class="appPrompt" style="margin: 0 ','px">\n      ','\n      <div class="appPrompt-icon">\n        ','\n      </div>\n      <div class="appPrompt-title">',"</div>\n      ",'\n      <div class="appPrompt-footer">\n        <div class="appPrompt-text">',"</div>\n        ",'\n      </div>\n      <div class="appPrompt-progressWrapper">\n        <div class="appPrompt-progress ','" style="background-color: ',"; animation-duration: ",'ms;"></div>\n      </div>\n    </div>'])),null===(t=this.options["product-name"])||void 0===t?void 0:t.toLowerCase(),this.offset,this.elements.closeIcon,this.icon,this.title,this.elements.profile,this.subtitle,this.elements.cta,e&&"appPrompt-progressPauseOnHover",this.options["loader-color"],this.options["loader-duration"])})),(0,c.A)(this,"addEventListeners",(()=>{var t;null!==(t=this.anchor)&&void 0!==t&&t.addEventListener("click",(()=>this.close({dismissalActions:!1}))),document.addEventListener("keydown",this.handleKeyDown),[this.elements.closeIcon,this.elements.cta].forEach((t=>t.addEventListener("click",this.close)))})),(0,c.A)(this,"handleKeyDown",(t=>{"Escape"===t.key&&this.close()})),(0,c.A)(this,"initRedirect",(function(){let i,o,s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=e.options["loader-duration"],a=()=>{o=performance.now(),i=setTimeout((()=>{e.close({saveDismissal:!1,dismissalActions:!1}),t.redirectTo(e.options["redirect-url"])}),n)},r=()=>{clearTimeout(i),n-=performance.now()-o};if(s){let t=document.querySelector(v.selectors.prompt);t&&(t.addEventListener("mouseenter",r),t.addEventListener("mouseleave",a))}return a(),()=>{if(clearTimeout(i),s){let t=document.querySelector(v.selectors.prompt);t&&(t.removeEventListener("mouseenter",r),t.removeEventListener("mouseleave",a))}}})),(0,c.A)(this,"isDismissedPrompt",(()=>t.getDismissedPrompts().includes(this.id))),(0,c.A)(this,"setDismissedPrompt",(()=>{let e=new Set(t.getDismissedPrompts());e.add(this.id),document.cookie="dismissedAppPrompts=".concat(JSON.stringify([...e]),";path=/")})),(0,c.A)(this,"close",(function(){var t,i;let{saveDismissal:s=!0,dismissalActions:n=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=document.querySelector(v.selectors.prompt);e.cleanupFn(),null!==a&&void 0!==a&&a.remove(),s&&e.setDismissedPrompt(),document.removeEventListener("keydown",e.handleKeyDown),null!==(t=e.anchor)&&void 0!==t&&t.focus(),null!==(i=e.anchor)&&void 0!==i&&i.removeEventListener("click",e.close),n&&(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.animationCount,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.animationDuration;t.classList.add("coach-indicator"),t.style.setProperty("--animation-duration","".concat(i,"ms"));let s=[];for(let r=0;r<3;r+=1){let i=(0,p.h)(o||(o=(0,d.A)(['\n    <div\n      class="coach-indicator-ring"\n      style="animation-iteration-count: ',';">\n    </div>'])),e);t.insertAdjacentElement("afterbegin",i),s.push(i)}let n=()=>{s.forEach((t=>t.remove())),t.classList.remove("coach-indicator")},a=setTimeout(n,(e+1)*i);t.addEventListener("click",(()=>{n(),clearTimeout(a)}),{once:!0})}(e.anchor,e.options["dismissal-animation-count"],e.options["dismissal-animation-duration"]),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.tooltipMessage,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.tooltipDuration;t.setAttribute("data-pep-dismissal-tooltip",e);let o=()=>t.removeAttribute("data-pep-dismissal-tooltip"),s=setTimeout(o,i);t.addEventListener("click",(()=>{o(),clearTimeout(s)}),{once:!0})}(e.anchor,e.options["dismissal-tooltip-message"],e.options["dismissal-tooltip-duration"]))})),this.promptPath=i,this.entName=s,this.parent=u,this.getAnchorState=y,this.id=this.promptPath.split("/").pop(),this.elements={},g())return window.addEventListener("milo:modal:closed",(()=>P(this.init)),{once:!0}),void(this.initializationQueued=!0);this.initializationQueued=!1}static redirectTo(t){window.location.assign(t)}},(0,c.A)(s,"getDismissedPrompts",(()=>{var t;let e=null===(t=document.cookie.split(";").find((t=>t.trim().startsWith("dismissedAppPrompts="))))||void 0===t?void 0:t.split("=")[1];return e?JSON.parse(e):[]})),s);async function w(t){try{let e=(0,m.i)();await e.georouting.loadedPromise,delete e.georouting;let i=new y(t);return i.initializationQueued||await i.init(),i}catch(e){return(0,p.d)({message:"Could not initialize PEP",e:e,tags:"pep",errorType:"e"}),null}}}}]);
//# sourceMappingURL=6591.887c7b02.chunk.js.map