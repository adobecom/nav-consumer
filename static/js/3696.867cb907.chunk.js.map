{"version":3,"file":"static/js/3696.867cb907.chunk.js","mappings":"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","sources":["../../milo/libs/utils/action.js","../../milo/tools/utils/utils.js","../../milo/libs/tools/utils/publish.js","../../milo/libs/utils/sidekick-decorate.js","../../milo/libs/utils/sidekick.js"],"sourcesContent":["export function debounce(callback, time = 300) {\n  if (typeof callback !== 'function') return undefined;\n\n  let timer = null;\n\n  return (...args) => {\n    clearTimeout(timer);\n    timer = setTimeout(() => callback(...args), time);\n  };\n}\n\nexport default { debounce };\n","const IMS_CLIENT_ID = 'milo_ims';\nconst IMS_PROD_URL = 'https://auth.services.adobe.com/imslib/imslib.min.js';\nconst STYLE_SHEETS = {};\nconst CONFIGS = {};\n\nconst getImsToken = async (loadScript) => {\n  window.adobeid = {\n    client_id: IMS_CLIENT_ID,\n    environment: 'prod',\n    scope: 'AdobeID,openid',\n  };\n\n  if (!window.adobeIMS) {\n    await loadScript(IMS_PROD_URL);\n  }\n  return window.adobeIMS?.getAccessToken()?.token;\n};\n\nconst getSheet = async (url) => {\n  if (STYLE_SHEETS[url]) return STYLE_SHEETS[url];\n  const resp = await fetch(url);\n  const text = await resp.text();\n  const sheet = new CSSStyleSheet();\n  sheet.replace(text);\n  STYLE_SHEETS[url] = sheet;\n  return sheet;\n};\n\nconst getCustomConfig = async (path) => {\n  /* c8 ignore next 3 */\n  if (CONFIGS[path] !== undefined) {\n    return CONFIGS[path];\n  }\n  let config = null;\n  const resp = await fetch(path);\n  if (resp.ok) {\n    config = await resp.json();\n  }\n  CONFIGS[path] = config;\n  return CONFIGS[path];\n};\n\nexport { getImsToken, getSheet, getCustomConfig };\n","import { getCustomConfig } from '../../../tools/utils/utils.js';\n\nconst userCanPublishPage = async (detail, isBulk = true) => {\n  if (!detail) return false;\n  const { live, profile, webPath } = detail;\n  let canPublish = isBulk ? live?.permissions?.includes('write') : true;\n  let message = 'Publishing is currently disabled for this page';\n  const config = await getCustomConfig('/.milo/publish-permissions-config.json?limit=50000');\n  const item = config?.urls?.data?.find(({ url }) => (\n    url.endsWith('**') ? webPath.includes(url.slice(0, -2)) : url === webPath\n  ));\n  if (item) {\n    canPublish = false;\n    if (item.message) message = item.message;\n    const group = config[item.group];\n    if (group && profile?.email) {\n      let isDeny;\n      const user = group.data?.find(({ allow, deny }) => {\n        if (deny) {\n          /* c8 ignore next 3 */\n          isDeny = true;\n          return deny === profile.email;\n        }\n        return allow === profile.email;\n      });\n      canPublish = isDeny ? !user : !!user;\n    }\n  }\n  return { canPublish, message };\n};\n\nexport default userCanPublishPage;\n","import userCanPublishPage from '../tools/utils/publish.js';\n\nconst PUBLISH_BTN = '.publish.plugin button';\nconst PROFILE = '.profile-email';\nconst CONFIRM_MESSAGE = 'Are you sure? This will publish to production.';\nlet stylePublishCalled = false;\n\nfunction styleHelixPublish(sk) {\n  const setupPublishBtn = async (page, btn) => {\n    const { canPublish, message } = await userCanPublishPage(page, false);\n    if (canPublish) {\n      btn.removeAttribute('disabled');\n    } else {\n      btn.setAttribute('disabled', true);\n    }\n    const messageText = btn.querySelector('span');\n    const text = canPublish ? CONFIRM_MESSAGE : message;\n    if (messageText) {\n      messageText.innerText = text;\n    } else {\n      btn.insertAdjacentHTML('beforeend', `<span>${text}</span>`);\n    }\n  };\n\n  const style = new CSSStyleSheet();\n  style.replaceSync(`\n    :host {\n      --bg-color: rgb(129 27 14);\n      --text-color: #fff0f0;\n      color-scheme: light dark;\n    }\n    .publish.plugin {\n      order: 100;\n    }\n    .publish.plugin button {\n      position: relative;\n    }\n    .publish.plugin button:not([disabled=true]) {\n      background: var(--bg-color);\n      border-color: #b46157;\n      color: var(--text-color);\n    }\n    .publish.plugin button:not([disabled=true]):hover {\n      background-color: var(--hlx-sk-button-hover-bg);\n      border-color: unset;\n      color: var(--hlx-sk-button-hover-color);\n    }\n    .publish.plugin button > span {\n      display: none;\n      background: #666;\n      border-radius: 4px;\n      line-height: 1.2rem;\n      padding: 8px 12px;\n      position: absolute;\n      top: 34px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 150px;\n      white-space: pre-wrap;\n    }\n    .publish.plugin button:not([disabled=true]) > span {\n      background: var(--bg-color);\n    }\n    .publish.plugin button:hover > span {\n      display: block;\n      color: var(--text-color);\n    }\n    .publish.plugin button > span:before {\n      content: '';\n      border-left: 6px solid transparent;\n      border-right: 6px solid transparent;\n      border-bottom: 6px solid #666;\n      position: absolute;\n      text-align: center;\n      top: -6px;\n      left: 50%;\n      transform: translateX(-50%);\n    }\n    .publish.plugin button:not([disabled=true]) > span:before {\n      border-bottom: 6px solid var(--bg-color);\n    }\n  `);\n\n  sk.shadowRoot.adoptedStyleSheets = [style];\n\n  sk.addEventListener('statusfetched', async (event) => {\n    const page = event?.detail?.data;\n    const btn = event?.target?.shadowRoot?.querySelector(PUBLISH_BTN);\n    if (page && btn) {\n      setupPublishBtn(page, btn);\n    }\n  });\n\n  setTimeout(async () => {\n    const btn = sk.shadowRoot.querySelector(PUBLISH_BTN);\n    btn?.setAttribute('disabled', true);\n    const message = btn?.querySelector('span');\n    if (btn && !message) {\n      const page = {\n        webPath: window.location.pathname,\n        // added for edge case where the statusfetched event isnt fired on refresh\n        profile: { email: sk.shadowRoot.querySelector(PROFILE)?.innerText },\n      };\n      setupPublishBtn(page, btn);\n    }\n  }, 500);\n}\n\nasync function checkAuthorization(page, btn) {\n  const { canPublish, message } = await userCanPublishPage(page, false);\n  if (canPublish) {\n    btn.removeAttribute('disabled');\n    return;\n  }\n\n  btn.setAttribute('disabled', true);\n  btn.insertAdjacentHTML('beforeend', `<span>${message}</span>`);\n  setTimeout(() => btn.querySelector('span').remove(), 4000);\n}\n\nexport default async function stylePublish(sk) {\n  if (stylePublishCalled) return;\n  stylePublishCalled = true;\n\n  if (sk.nodeName === 'HELIX-SIDEKICK') {\n    styleHelixPublish(sk);\n    return;\n  }\n\n  const style = new CSSStyleSheet();\n  style.replaceSync(`\n    sk-action-button.publish {\n      position: relative;\n    }\n    sk-action-button.publish > span {\n      display: none;\n      background: #777;\n      border-radius: 4px;\n      line-height: 1.2rem;\n      padding: 8px 12px;\n      position: absolute;\n      bottom: 34px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 150px;\n      white-space: pre-wrap;\n      color: black;\n    }\n    sk-action-button.publish[disabled] > span {\n      display: block;\n    }\n    sk-action-button.publish > span:before {\n      content: '';\n      border-left: 6px solid transparent;\n      border-right: 6px solid transparent;\n      border-top: 6px solid #777;\n      position: absolute;\n      text-align: center;\n      bottom: -6px;\n      left: 50%;\n      transform: translateX(-50%);\n    }\n  `);\n\n  const pluginActionBarSR = sk.shadowRoot.querySelector('plugin-action-bar').shadowRoot;\n  pluginActionBarSR.adoptedStyleSheets ??= [];\n  pluginActionBarSR.adoptedStyleSheets.push(style);\n\n  const publishBtn = pluginActionBarSR.querySelector('sk-action-button.publish');\n  if (!publishBtn) {\n    sk.addEventListener('status-fetched', ({ target, detail }) => {\n      setTimeout(async () => {\n        const btn = target.shadowRoot.querySelector('plugin-action-bar').shadowRoot.querySelector('sk-action-button.publish');\n        if (detail && btn) await checkAuthorization(detail, btn);\n      }, 0);\n    });\n  }\n\n  const pageDetail = {\n    webPath: window.location.pathname,\n    profile: { email: pluginActionBarSR.querySelector('#user')?.shadowRoot.querySelector('.user [slot=\"description\"]')?.innerText },\n  };\n  if (pageDetail && publishBtn) await checkAuthorization(pageDetail, publishBtn);\n}\n","import stylePublish from './sidekick-decorate.js';\nimport { debounce } from './action.js';\n\n// loadScript and loadStyle are passed in to avoid circular dependencies\nexport default function init({ createTag, loadBlock, loadScript, loadStyle }) {\n  const sendToCaasListener = async (e) => {\n    // handle v2 and v3 sidekick events\n    const config = e.detail.data?.config ?? e.detail.config;\n    const { host, project, ref: branch, repo, owner } = config;\n    // eslint-disable-next-line import/no-unresolved\n    const { sendToCaaS } = await import('https://milo.adobe.com/tools/send-to-caas/send-to-caas.js');\n    sendToCaaS({ host, project, branch, repo, owner }, loadScript, loadStyle);\n  };\n\n  const checkSchemaListener = async () => {\n    const schema = document.querySelector('script[type=\"application/ld+json\"]');\n    if (schema === null) return;\n    const resultsUrl = 'https://search.google.com/test/rich-results?url=';\n    window.open(`${resultsUrl}${encodeURIComponent(window.location.href)}`, 'check-schema');\n  };\n\n  const preflightListener = async () => {\n    const preflight = createTag('div', { class: 'preflight' });\n    const content = await loadBlock(preflight);\n\n    const { getModal } = await import('../blocks/modal/modal.js');\n    getModal(null, { id: 'preflight', content, closeEvent: 'closeModal' });\n  };\n\n  const sk = document.querySelector('aem-sidekick, helix-sidekick');\n\n  // Add plugin listeners here\n  sk.addEventListener('custom:send-to-caas', debounce(sendToCaasListener, 500));\n  sk.addEventListener('custom:check-schema', checkSchemaListener);\n  sk.addEventListener('custom:preflight', debounce(() => preflightListener(), 500));\n\n  // Color code publish button\n  stylePublish(sk);\n}\n"],"names":["o","e","n","arguments","length","undefined","t","_len","u","Array","_key","clearTimeout","setTimeout","r","debounce","c","p","async","_n$permissions","_r$urls","live","profile","webPath","s","i","permissions","includes","a","fetch","ok","json","f","l","urls","data","find","_ref","url","endsWith","slice","message","group","email","_u$data","d","b","_ref2","allow","w","deny","h","canPublish","g","x","v","m","S","removeAttribute","setAttribute","insertAdjacentHTML","concat","querySelector","remove","k","_n$adoptedStyleSheets","_n$querySelector","nodeName","innerText","CSSStyleSheet","replaceSync","shadowRoot","adoptedStyleSheets","addEventListener","_t$detail","_t$target","detail","target","_e$shadowRoot$querySe","window","location","pathname","P","push","_ref3","createTag","loadBlock","loadScript","loadStyle","document","_e$detail$data$config","_e$detail$data","config","host","project","ref","repo","owner","sendToCaaS","branch","open","encodeURIComponent","href","class","getModal","id","content","closeEvent"],"sourceRoot":""}